{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/bosh.js","webpack:///./src/core.js","webpack:///./src/md5.js","webpack:///./src/sha1.js","webpack:///./src/strophe.js","webpack:///./src/utils.js","webpack:///./src/websocket.js"],"names":["Request","elem","func","rid","sends","id","_requestId","xmlData","data","serialize","origFunc","date","NaN","abort","dead","age","now","Date","timeDead","xhr","_newXHR","prototype","getResponse","node","responseXML","documentElement","tagName","Strophe","error","responseText","Error","debug","DOMParser","parseFromString","querySelector","textContent","window","XMLHttpRequest","overrideMimeType","ActiveXObject","onreadystatechange","bind","Bosh","connection","_conn","Math","floor","random","sid","hold","wait","errors","inactivity","lastResponseHeaders","_requests","strip","_buildBody","bodyWrap","NS","HTTPBIND","attrs","options","keepalive","_sessionCachingSupported","_cacheSession","_reset","sessionStorage","removeItem","nextValidRid","_connect","route","body","domain","BOSH","_connect_cb","push","tree","_onRequestStateChange","getAttribute","_throttledRequestHandler","_attach","jid","callback","wind","connect_callback","getDomainFromJid","authenticated","connected","_changeConnectStatus","Status","ATTACHED","_restore","session","JSON","parse","getItem","getBareJidFromJid","getNodeFromJid","restored","name","setItem","stringify","typ","cond","conflict","getElementsByTagName","length","CONNFAIL","_doDisconnect","parseInt","_disconnect","pres","_sendTerminate","_emptyQueue","_callProtocolErrorHandlers","req","reqStatus","_getRequestStatus","err_callback","protocolErrorHandlers","HTTP","call","_hitError","warn","_onDisconnectTimeout","_no_auth_received","_abortAllRequests","pop","_onIdle","_data","disconnecting","info","paused","i","cnode","up","_dataRecv","time_elapsed","SECONDARY_TIMEOUT","TIMEOUT","def","readyState","status","e","getAllResponseHeaders","valid_request","too_many_retries","maxRetries","_removeRequest","reqIs0","reqIs1","_restartRequest","Number","DISCONNECTING","_processRequest","primary_timeout","isNaN","secondary_timeout","server_error","content_type","contentType","open","service","sync","setRequestHeader","withCredentials","e2","toString","disconnect","sendFunc","self","customHeaders","headers","header","Object","hasOwnProperty","send","backoff","min","pow","setTimeout","xmlOutput","Connection","nodeName","childNodes","rawOutput","splice","_reqToData","message","type","_send","clearTimeout","_idleTimeout","_sendRestart","abs","$build","Builder","$msg","$iq","$pres","VERSION","CLIENT","AUTH","ROSTER","PROFILE","DISCO_INFO","DISCO_ITEMS","MUC","SASL","STREAM","FRAMING","BIND","SESSION","STANZAS","XHTML_IM","XHTML","tags","attributes","css","validTag","tag","validAttribute","attribute","validCSS","style","ERROR","CONNECTING","AUTHENTICATING","AUTHFAIL","CONNECTED","DISCONNECTED","REDIRECT","CONNTIMEOUT","ErrorCondition","BAD_FORMAT","CONFLICT","MISSING_JID_NODE","NO_AUTH_MECH","UNKNOWN_REASON","LogLevel","DEBUG","INFO","WARN","FATAL","ElementType","NORMAL","TEXT","CDATA","FRAGMENT","addNamespace","value","forEachChild","elemName","childNode","nodeType","isTagEqual","el","_xmlGenerator","_makeGenerator","doc","document","implementation","createDocument","undefined","documentMode","_getIEXmlDom","appendChild","createElement","xmlGenerator","docStrings","d","xmlElement","a","arguments","arg","xmlTextNode","sort","attr","setAttribute","k","xmlescape","text","replace","xmlunescape","createTextNode","xmlHtmlNode","html","parser","async","loadXML","getText","str","nodeValue","copyElement","createHtml","toLowerCase","cssText","cssAttrs","split","j","cssName","cssValue","join","createDocumentFragment","escapeNode","unescapeNode","indexOf","bare","parts","getResourceFromJid","s","_handleError","stack","fatal","sourceURL","handler","line","fileName","lineNumber","log","level","msg","console","result","child","_connectionPlugins","addConnectionPlugin","ptype","xmlns","nodeTree","parentNode","root","moreattrs","removeAttribute","c","impNode","xmlGen","importNode","newElem","t","h","fragment","innerHTML","xhtml","Handler","ns","from","matchBare","matchBareFromJid","user","getNamespace","elNamespace","ignoreNamespaceFragment","namespaceMatch","nsMatch","isMatch","elem_type","Array","isArray","run","TimedHandler","period","lastCalled","getTime","reset","proto","protocol","_proto","Websocket","features","_sasl_data","do_session","do_bind","timedHandlers","handlers","removeTimeds","removeHandlers","addTimeds","addHandlers","_disconnectTimeout","do_authentication","_uniqueId","_sasl_success_handler","_sasl_failure_handler","_sasl_challenge_handler","utils","addCookies","cookies","registerSASLMechanisms","mechanisms","F","init","pause","resume","getUniqueId","suffix","uuid","r","v","addProtocolErrorHandler","status_code","connect","pass","authcid","authzid","servtype","attach","restore","xmlInput","rawInput","_queueData","flush","sendPresence","errback","timeout","timeoutHandler","addHandler","stanza","deleteTimedHandler","addTimedHandler","deleteHandler","sendIQ","iqtype","element","thand","handRef","hand","SASLAnonymous","SASLExternal","SASLMD5","SASLOAuthBearer","SASLXOAuth2","SASLPlain","SASLSHA1","forEach","registerSASLMechanism","mechanism","reason","_addSysTimedHandler","condition","plugin","statusChanged","err","raw","UNKOWN_REASON","newList","_callback","conncheck","hasFeatures","getElementsByTagNameNS","matched","mech","authenticate","sortMechanismsByPriority","higher","priority","swap","_attemptSASLAuth","mechanism_found","test","_addSysHandler","_sasl_success_cb","_sasl_failure_cb","_sasl_challenge_cb","_sasl_mechanism","onStart","request_auth_exchange","isClientFirst","response","onChallenge","btoa","_attemptLegacyAuth","_auth1_cb","challenge","atob","iq","_auth2_cb","serverSignature","success","attribMatch","matches","match","onSuccess","streamfeature_handlers","wrapper","_sasl_auth1_cb","_sasl_bind_cb","resource","jidNode","_sasl_session_cb","onFailure","since","SASLMechanism","_connection","auth_str","utf16to8","test_cnonce","cnonce","hexdigest","nonce","salt","iter","Hi","U","U_old","authMessage","substr","core_hmac_sha1","binb2str","clientKey","serverKey","str_hmac_sha1","clientSignature","str_sha1","b64_hmac_sha1","_quote","realm","host","qop","digest_uri","cred","A1","hash","A2","helpers","MD5","safe_add","x","y","lsw","msw","bit_rol","num","cnt","str2binl","bin","charCodeAt","binl2str","String","fromCharCode","binl2hex","binarray","hex_tab","charAt","md5_cmn","q","b","md5_ff","md5_gg","md5_hh","md5_ii","core_md5","len","olda","oldb","oldc","oldd","core_sha1","w","olde","rol","sha1_ft","sha1_kt","key","bkey","str2binb","ipad","opad","concat","mask","binb2b64","tab","triplet","SHA1","b64_sha1","out","cookieName","expires","path","cookieObj","isObj","cookieValue","escape","unescape","cookie","new_service","location","pathname","_buildStream","_check_streamerror","connectstatus","errorString","_closeSocket","socket","WebSocket","onopen","_onOpen","onerror","_onError","onclose","_onClose","onmessage","_connect_cb_wrapper","_handleStreamStart","ver","streamStart","parsedMessage","see_uri","isSecureRedirect","string","_streamWrap","_onMessage","CLOSED","close","closeString","code","rawStanza","search","firstChild","start","startString"],"mappings":"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","file":"strophe.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/strophe.js\");\n","/*\n    This program is distributed under the terms of the MIT license.\n    Please see the LICENSE file for details.\n\n    Copyright 2006-2008, OGG, LLC\n*/\n\n/* global window, setTimeout, clearTimeout, XMLHttpRequest, ActiveXObject */\n\nimport { $build, Strophe } from 'core';\n\n/** PrivateClass: Strophe.Request\n *  _Private_ helper class that provides a cross implementation abstraction\n *  for a BOSH related XMLHttpRequest.\n *\n *  The Strophe.Request class is used internally to encapsulate BOSH request\n *  information.  It is not meant to be used from user's code.\n */\n\n/** PrivateConstructor: Strophe.Request\n *  Create and initialize a new Strophe.Request object.\n *\n *  Parameters:\n *    (XMLElement) elem - The XML data to be sent in the request.\n *    (Function) func - The function that will be called when the\n *      XMLHttpRequest readyState changes.\n *    (Integer) rid - The BOSH rid attribute associated with this request.\n *    (Integer) sends - The number of times this same request has been sent.\n */\nStrophe.Request = function (elem, func, rid, sends) {\n    this.id = ++Strophe._requestId;\n    this.xmlData = elem;\n    this.data = Strophe.serialize(elem);\n    // save original function in case we need to make a new request\n    // from this one.\n    this.origFunc = func;\n    this.func = func;\n    this.rid = rid;\n    this.date = NaN;\n    this.sends = sends || 0;\n    this.abort = false;\n    this.dead = null;\n\n    this.age = function () {\n        if (!this.date) { return 0; }\n        const now = new Date();\n        return (now - this.date) / 1000;\n    };\n    this.timeDead = function () {\n        if (!this.dead) { return 0; }\n        const now = new Date();\n        return (now - this.dead) / 1000;\n    };\n    this.xhr = this._newXHR();\n};\n\nStrophe.Request.prototype = {\n    /** PrivateFunction: getResponse\n     *  Get a response from the underlying XMLHttpRequest.\n     *\n     *  This function attempts to get a response from the request and checks\n     *  for errors.\n     *\n     *  Throws:\n     *    \"parsererror\" - A parser error occured.\n     *    \"badformat\" - The entity has sent XML that cannot be processed.\n     *\n     *  Returns:\n     *    The DOM element tree of the response.\n     */\n    getResponse: function () {\n        let node = null;\n        if (this.xhr.responseXML && this.xhr.responseXML.documentElement) {\n            node = this.xhr.responseXML.documentElement;\n            if (node.tagName === \"parsererror\") {\n                Strophe.error(\"invalid response received\");\n                Strophe.error(\"responseText: \" + this.xhr.responseText);\n                Strophe.error(\"responseXML: \" +\n                              Strophe.serialize(this.xhr.responseXML));\n                throw new Error(\"parsererror\");\n            }\n        } else if (this.xhr.responseText) {\n            // In React Native, we may get responseText but no responseXML.  We can try to parse it manually.\n            Strophe.debug(\"Got responseText but no responseXML; attempting to parse it with DOMParser...\");\n            node = new DOMParser().parseFromString(this.xhr.responseText, 'application/xml').documentElement;\n            if (!node) {\n                throw new Error('Parsing produced null node');\n            } else if (node.querySelector('parsererror')) {\n                Strophe.error(\"invalid response received: \" + node.querySelector('parsererror').textContent);\n                Strophe.error(\"responseText: \" + this.xhr.responseText);\n                throw new Error(\"badformat\");\n            }\n        }\n        return node;\n    },\n\n    /** PrivateFunction: _newXHR\n     *  _Private_ helper function to create XMLHttpRequests.\n     *\n     *  This function creates XMLHttpRequests across all implementations.\n     *\n     *  Returns:\n     *    A new XMLHttpRequest.\n     */\n    _newXHR: function () {\n        let xhr = null;\n        if (window.XMLHttpRequest) {\n            xhr = new XMLHttpRequest();\n            if (xhr.overrideMimeType) {\n                xhr.overrideMimeType(\"text/xml; charset=utf-8\");\n            }\n        } else if (window.ActiveXObject) {\n            xhr = new ActiveXObject(\"Microsoft.XMLHTTP\");\n        }\n        // use Function.bind() to prepend ourselves as an argument\n        xhr.onreadystatechange = this.func.bind(null, this);\n        return xhr;\n    }\n};\n\n/** Class: Strophe.Bosh\n *  _Private_ helper class that handles BOSH Connections\n *\n *  The Strophe.Bosh class is used internally by Strophe.Connection\n *  to encapsulate BOSH sessions. It is not meant to be used from user's code.\n */\n\n/** File: bosh.js\n *  A JavaScript library to enable BOSH in Strophejs.\n *\n *  this library uses Bidirectional-streams Over Synchronous HTTP (BOSH)\n *  to emulate a persistent, stateful, two-way connection to an XMPP server.\n *  More information on BOSH can be found in XEP 124.\n */\n\n/** PrivateConstructor: Strophe.Bosh\n *  Create and initialize a Strophe.Bosh object.\n *\n *  Parameters:\n *    (Strophe.Connection) connection - The Strophe.Connection that will use BOSH.\n *\n *  Returns:\n *    A new Strophe.Bosh object.\n */\nStrophe.Bosh = function(connection) {\n    this._conn = connection;\n    /* request id for body tags */\n    this.rid = Math.floor(Math.random() * 4294967295);\n    /* The current session ID. */\n    this.sid = null;\n\n    // default BOSH values\n    this.hold = 1;\n    this.wait = 60;\n    this.window = 5;\n    this.errors = 0;\n    this.inactivity = null;\n\n    this.lastResponseHeaders = null;\n    this._requests = [];\n};\n\nStrophe.Bosh.prototype = {\n    /** Variable: strip\n     *\n     *  BOSH-Connections will have all stanzas wrapped in a <body> tag when\n     *  passed to <Strophe.Connection.xmlInput> or <Strophe.Connection.xmlOutput>.\n     *  To strip this tag, User code can set <Strophe.Bosh.strip> to \"body\":\n     *\n     *  > Strophe.Bosh.prototype.strip = \"body\";\n     *\n     *  This will enable stripping of the body tag in both\n     *  <Strophe.Connection.xmlInput> and <Strophe.Connection.xmlOutput>.\n     */\n    strip: null,\n\n    /** PrivateFunction: _buildBody\n     *  _Private_ helper function to generate the <body/> wrapper for BOSH.\n     *\n     *  Returns:\n     *    A Strophe.Builder with a <body/> element.\n     */\n    _buildBody: function () {\n        const bodyWrap = $build('body', {\n            'rid': this.rid++,\n            'xmlns': Strophe.NS.HTTPBIND\n        });\n        if (this.sid !== null) {\n            bodyWrap.attrs({'sid': this.sid});\n        }\n        if (this._conn.options.keepalive && this._conn._sessionCachingSupported()) {\n            this._cacheSession();\n        }\n        return bodyWrap;\n    },\n\n    /** PrivateFunction: _reset\n     *  Reset the connection.\n     *\n     *  This function is called by the reset function of the Strophe Connection\n     */\n    _reset: function () {\n        this.rid = Math.floor(Math.random() * 4294967295);\n        this.sid = null;\n        this.errors = 0;\n        if (this._conn._sessionCachingSupported()) {\n            window.sessionStorage.removeItem('strophe-bosh-session');\n        }\n\n        this._conn.nextValidRid(this.rid);\n    },\n\n    /** PrivateFunction: _connect\n     *  _Private_ function that initializes the BOSH connection.\n     *\n     *  Creates and sends the Request that initializes the BOSH connection.\n     */\n    _connect: function (wait, hold, route) {\n        this.wait = wait || this.wait;\n        this.hold = hold || this.hold;\n        this.errors = 0;\n\n        const body = this._buildBody().attrs({\n            \"to\": this._conn.domain,\n            \"xml:lang\": \"en\",\n            \"wait\": this.wait,\n            \"hold\": this.hold,\n            \"content\": \"text/xml; charset=utf-8\",\n            \"ver\": \"1.6\",\n            \"xmpp:version\": \"1.0\",\n            \"xmlns:xmpp\": Strophe.NS.BOSH\n        });\n        if (route){\n            body.attrs({'route': route});\n        }\n\n        const _connect_cb = this._conn._connect_cb;\n        this._requests.push(\n            new Strophe.Request(\n                body.tree(),\n                this._onRequestStateChange.bind(this, _connect_cb.bind(this._conn)),\n                body.tree().getAttribute(\"rid\")\n            )\n        );\n        this._throttledRequestHandler();\n    },\n\n    /** PrivateFunction: _attach\n     *  Attach to an already created and authenticated BOSH session.\n     *\n     *  This function is provided to allow Strophe to attach to BOSH\n     *  sessions which have been created externally, perhaps by a Web\n     *  application.  This is often used to support auto-login type features\n     *  without putting user credentials into the page.\n     *\n     *  Parameters:\n     *    (String) jid - The full JID that is bound by the session.\n     *    (String) sid - The SID of the BOSH session.\n     *    (String) rid - The current RID of the BOSH session.  This RID\n     *      will be used by the next request.\n     *    (Function) callback The connect callback function.\n     *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n     *      time the server will wait before returning an empty result for\n     *      a request.  The default setting of 60 seconds is recommended.\n     *      Other settings will require tweaks to the Strophe.TIMEOUT value.\n     *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n     *      number of connections the server will hold at one time.  This\n     *      should almost always be set to 1 (the default).\n     *    (Integer) wind - The optional HTTBIND window value.  This is the\n     *      allowed range of request ids that are valid.  The default is 5.\n     */\n    _attach: function (jid, sid, rid, callback, wait, hold, wind) {\n        this._conn.jid = jid;\n        this.sid = sid;\n        this.rid = rid;\n\n        this._conn.connect_callback = callback;\n        this._conn.domain = Strophe.getDomainFromJid(this._conn.jid);\n        this._conn.authenticated = true;\n        this._conn.connected = true;\n\n        this.wait = wait || this.wait;\n        this.hold = hold || this.hold;\n        this.window = wind || this.window;\n\n        this._conn._changeConnectStatus(Strophe.Status.ATTACHED, null);\n    },\n\n    /** PrivateFunction: _restore\n     *  Attempt to restore a cached BOSH session\n     *\n     *  Parameters:\n     *    (String) jid - The full JID that is bound by the session.\n     *      This parameter is optional but recommended, specifically in cases\n     *      where prebinded BOSH sessions are used where it's important to know\n     *      that the right session is being restored.\n     *    (Function) callback The connect callback function.\n     *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n     *      time the server will wait before returning an empty result for\n     *      a request.  The default setting of 60 seconds is recommended.\n     *      Other settings will require tweaks to the Strophe.TIMEOUT value.\n     *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n     *      number of connections the server will hold at one time.  This\n     *      should almost always be set to 1 (the default).\n     *    (Integer) wind - The optional HTTBIND window value.  This is the\n     *      allowed range of request ids that are valid.  The default is 5.\n     */\n    _restore: function (jid, callback, wait, hold, wind) {\n        const session = JSON.parse(window.sessionStorage.getItem('strophe-bosh-session'));\n        if (typeof session !== \"undefined\" &&\n                   session !== null &&\n                   session.rid &&\n                   session.sid &&\n                   session.jid &&\n                   (    typeof jid === \"undefined\" ||\n                        jid === null ||\n                        Strophe.getBareJidFromJid(session.jid) === Strophe.getBareJidFromJid(jid) ||\n                        // If authcid is null, then it's an anonymous login, so\n                        // we compare only the domains:\n                        ((Strophe.getNodeFromJid(jid) === null) && (Strophe.getDomainFromJid(session.jid) === jid))\n                    )\n        ) {\n            this._conn.restored = true;\n            this._attach(session.jid, session.sid, session.rid, callback, wait, hold, wind);\n        } else {\n            const error = new Error(\"_restore: no restoreable session.\");\n            error.name = \"StropheSessionError\";\n            throw error;\n        }\n    },\n\n    /** PrivateFunction: _cacheSession\n     *  _Private_ handler for the beforeunload event.\n     *\n     *  This handler is used to process the Bosh-part of the initial request.\n     *  Parameters:\n     *    (Strophe.Request) bodyWrap - The received stanza.\n     */\n    _cacheSession: function () {\n        if (this._conn.authenticated) {\n            if (this._conn.jid && this.rid && this.sid) {\n                window.sessionStorage.setItem('strophe-bosh-session', JSON.stringify({\n                    'jid': this._conn.jid,\n                    'rid': this.rid,\n                    'sid': this.sid\n                }));\n            }\n        } else {\n            window.sessionStorage.removeItem('strophe-bosh-session');\n        }\n    },\n\n    /** PrivateFunction: _connect_cb\n     *  _Private_ handler for initial connection request.\n     *\n     *  This handler is used to process the Bosh-part of the initial request.\n     *  Parameters:\n     *    (Strophe.Request) bodyWrap - The received stanza.\n     */\n    _connect_cb: function (bodyWrap) {\n        const typ = bodyWrap.getAttribute(\"type\");\n        if (typ !== null && typ === \"terminate\") {\n            // an error occurred\n            let cond = bodyWrap.getAttribute(\"condition\");\n            Strophe.error(\"BOSH-Connection failed: \" + cond);\n            const conflict = bodyWrap.getElementsByTagName(\"conflict\");\n            if (cond !== null) {\n                if (cond === \"remote-stream-error\" && conflict.length > 0) {\n                    cond = \"conflict\";\n                }\n                this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, cond);\n            } else {\n                this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"unknown\");\n            }\n            this._conn._doDisconnect(cond);\n            return Strophe.Status.CONNFAIL;\n        }\n\n        // check to make sure we don't overwrite these if _connect_cb is\n        // called multiple times in the case of missing stream:features\n        if (!this.sid) {\n            this.sid = bodyWrap.getAttribute(\"sid\");\n        }\n        const wind = bodyWrap.getAttribute('requests');\n        if (wind) { this.window = parseInt(wind, 10); }\n        const hold = bodyWrap.getAttribute('hold');\n        if (hold) { this.hold = parseInt(hold, 10); }\n        const wait = bodyWrap.getAttribute('wait');\n        if (wait) { this.wait = parseInt(wait, 10); }\n        const inactivity = bodyWrap.getAttribute('inactivity');\n        if (inactivity) { this.inactivity = parseInt(inactivity, 10); }\n    },\n\n    /** PrivateFunction: _disconnect\n     *  _Private_ part of Connection.disconnect for Bosh\n     *\n     *  Parameters:\n     *    (Request) pres - This stanza will be sent before disconnecting.\n     */\n    _disconnect: function (pres) {\n        this._sendTerminate(pres);\n    },\n\n    /** PrivateFunction: _doDisconnect\n     *  _Private_ function to disconnect.\n     *\n     *  Resets the SID and RID.\n     */\n    _doDisconnect: function () {\n        this.sid = null;\n        this.rid = Math.floor(Math.random() * 4294967295);\n        if (this._conn._sessionCachingSupported()) {\n            window.sessionStorage.removeItem('strophe-bosh-session');\n        }\n\n        this._conn.nextValidRid(this.rid);\n    },\n\n    /** PrivateFunction: _emptyQueue\n     * _Private_ function to check if the Request queue is empty.\n     *\n     *  Returns:\n     *    True, if there are no Requests queued, False otherwise.\n     */\n    _emptyQueue: function () {\n        return this._requests.length === 0;\n    },\n\n    /** PrivateFunction: _callProtocolErrorHandlers\n     *  _Private_ function to call error handlers registered for HTTP errors.\n     *\n     *  Parameters:\n     *    (Strophe.Request) req - The request that is changing readyState.\n     */\n    _callProtocolErrorHandlers: function (req) {\n        const reqStatus = this._getRequestStatus(req);\n        const err_callback = this._conn.protocolErrorHandlers.HTTP[reqStatus];\n        if (err_callback) {\n            err_callback.call(this, reqStatus);\n        }\n    },\n\n    /** PrivateFunction: _hitError\n     *  _Private_ function to handle the error count.\n     *\n     *  Requests are resent automatically until their error count reaches\n     *  5.  Each time an error is encountered, this function is called to\n     *  increment the count and disconnect if the count is too high.\n     *\n     *  Parameters:\n     *    (Integer) reqStatus - The request status.\n     */\n    _hitError: function (reqStatus) {\n        this.errors++;\n        Strophe.warn(\"request errored, status: \" + reqStatus +\n                     \", number of errors: \" + this.errors);\n        if (this.errors > 4) {\n            this._conn._onDisconnectTimeout();\n        }\n    },\n\n    /** PrivateFunction: _no_auth_received\n     *\n     * Called on stream start/restart when no stream:features\n     * has been received and sends a blank poll request.\n     */\n    _no_auth_received: function (callback) {\n        Strophe.warn(\"Server did not yet offer a supported authentication \"+\n                     \"mechanism. Sending a blank poll request.\");\n        if (callback) {\n            callback = callback.bind(this._conn);\n        } else {\n            callback = this._conn._connect_cb.bind(this._conn);\n        }\n        const body = this._buildBody();\n        this._requests.push(\n            new Strophe.Request(\n                body.tree(),\n                this._onRequestStateChange.bind(this, callback),\n                body.tree().getAttribute(\"rid\")\n            )\n        );\n        this._throttledRequestHandler();\n    },\n\n    /** PrivateFunction: _onDisconnectTimeout\n     *  _Private_ timeout handler for handling non-graceful disconnection.\n     *\n     *  Cancels all remaining Requests and clears the queue.\n     */\n    _onDisconnectTimeout: function () {\n        this._abortAllRequests();\n    },\n\n    /** PrivateFunction: _abortAllRequests\n     *  _Private_ helper function that makes sure all pending requests are aborted.\n     */\n    _abortAllRequests: function _abortAllRequests() {\n        while (this._requests.length > 0) {\n            const req = this._requests.pop();\n            req.abort = true;\n            req.xhr.abort();\n            // jslint complains, but this is fine. setting to empty func\n            // is necessary for IE6\n            req.xhr.onreadystatechange = function () {}; // jshint ignore:line\n        }\n    },\n\n    /** PrivateFunction: _onIdle\n     *  _Private_ handler called by Strophe.Connection._onIdle\n     *\n     *  Sends all queued Requests or polls with empty Request if there are none.\n     */\n    _onIdle: function () {\n        const data = this._conn._data;\n        // if no requests are in progress, poll\n        if (this._conn.authenticated && this._requests.length === 0 &&\n            data.length === 0 && !this._conn.disconnecting) {\n            Strophe.info(\"no requests during idle cycle, sending \" +\n                         \"blank request\");\n            data.push(null);\n        }\n\n        if (this._conn.paused) {\n            return;\n        }\n\n        if (this._requests.length < 2 && data.length > 0) {\n            const body = this._buildBody();\n            for (let i=0; i<data.length; i++) {\n                if (data[i] !== null) {\n                    if (data[i] === \"restart\") {\n                        body.attrs({\n                            \"to\": this._conn.domain,\n                            \"xml:lang\": \"en\",\n                            \"xmpp:restart\": \"true\",\n                            \"xmlns:xmpp\": Strophe.NS.BOSH\n                        });\n                    } else {\n                        body.cnode(data[i]).up();\n                    }\n                }\n            }\n            delete this._conn._data;\n            this._conn._data = [];\n            this._requests.push(\n                new Strophe.Request(\n                    body.tree(),\n                    this._onRequestStateChange.bind(this, this._conn._dataRecv.bind(this._conn)),\n                    body.tree().getAttribute(\"rid\")\n                )\n            );\n            this._throttledRequestHandler();\n        }\n\n        if (this._requests.length > 0) {\n            const time_elapsed = this._requests[0].age();\n            if (this._requests[0].dead !== null) {\n                if (this._requests[0].timeDead() >\n                    Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait)) {\n                    this._throttledRequestHandler();\n                }\n            }\n            if (time_elapsed > Math.floor(Strophe.TIMEOUT * this.wait)) {\n                Strophe.warn(\"Request \" +\n                             this._requests[0].id +\n                             \" timed out, over \" + Math.floor(Strophe.TIMEOUT * this.wait) +\n                             \" seconds since last activity\");\n                this._throttledRequestHandler();\n            }\n        }\n    },\n\n    /** PrivateFunction: _getRequestStatus\n     *\n     *  Returns the HTTP status code from a Strophe.Request\n     *\n     *  Parameters:\n     *    (Strophe.Request) req - The Strophe.Request instance.\n     *    (Integer) def - The default value that should be returned if no\n     *          status value was found.\n     */\n    _getRequestStatus: function (req, def) {\n        let reqStatus;\n        if (req.xhr.readyState === 4) {\n            try {\n                reqStatus = req.xhr.status;\n            } catch (e) {\n                // ignore errors from undefined status attribute. Works\n                // around a browser bug\n                Strophe.error(\n                    \"Caught an error while retrieving a request's status, \" +\n                    \"reqStatus: \" + reqStatus);\n            }\n        }\n        if (typeof(reqStatus) === \"undefined\") {\n            reqStatus = typeof def === 'number' ? def : 0;\n        }\n        return reqStatus;\n    },\n\n    /** PrivateFunction: _onRequestStateChange\n     *  _Private_ handler for Strophe.Request state changes.\n     *\n     *  This function is called when the XMLHttpRequest readyState changes.\n     *  It contains a lot of error handling logic for the many ways that\n     *  requests can fail, and calls the request callback when requests\n     *  succeed.\n     *\n     *  Parameters:\n     *    (Function) func - The handler for the request.\n     *    (Strophe.Request) req - The request that is changing readyState.\n     */\n    _onRequestStateChange: function (func, req) {\n        Strophe.debug(\"request id \"+req.id+\".\"+req.sends+\n                      \" state changed to \"+req.xhr.readyState);\n        if (req.abort) {\n            req.abort = false;\n            return;\n        }\n        if (req.xhr.readyState !== 4) {\n            // The request is not yet complete\n            return;\n        }\n        const reqStatus = this._getRequestStatus(req);\n        this.lastResponseHeaders = req.xhr.getAllResponseHeaders();\n        if (this.disconnecting && reqStatus >= 400) {\n            this._hitError(reqStatus);\n            this._callProtocolErrorHandlers(req);\n            return;\n        }\n\n        const valid_request = reqStatus > 0 && reqStatus < 500;\n        const too_many_retries = req.sends > this._conn.maxRetries;\n        if (valid_request || too_many_retries) {\n            // remove from internal queue\n            this._removeRequest(req);\n            Strophe.debug(\"request id \"+req.id+\" should now be removed\");\n        }\n\n        if (reqStatus === 200) {\n            // request succeeded\n            const reqIs0 = (this._requests[0] === req);\n            const reqIs1 = (this._requests[1] === req);\n            // if request 1 finished, or request 0 finished and request\n            // 1 is over Strophe.SECONDARY_TIMEOUT seconds old, we need to\n            // restart the other - both will be in the first spot, as the\n            // completed request has been removed from the queue already\n            if (reqIs1 ||\n                (reqIs0 && this._requests.length > 0 &&\n                    this._requests[0].age() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait))) {\n                this._restartRequest(0);\n            }\n            this._conn.nextValidRid(Number(req.rid) + 1);\n            Strophe.debug(\"request id \"+req.id+\".\"+req.sends+\" got 200\");\n            func(req); // call handler\n            this.errors = 0;\n        } else if (reqStatus === 0 ||\n                   (reqStatus >= 400 && reqStatus < 600) ||\n                   reqStatus >= 12000) {\n            // request failed\n            Strophe.error(\"request id \"+req.id+\".\"+req.sends+\" error \"+reqStatus+\" happened\");\n            this._hitError(reqStatus);\n            this._callProtocolErrorHandlers(req);\n            if (reqStatus >= 400 && reqStatus < 500) {\n                this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING, null);\n                this._conn._doDisconnect();\n            }\n        } else {\n            Strophe.error(\"request id \"+req.id+\".\"+req.sends+\" error \"+reqStatus+\" happened\");\n        }\n\n        if (!valid_request && !too_many_retries) {\n            this._throttledRequestHandler();\n        } else if (too_many_retries && !this._conn.connected) {\n            this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"giving-up\");\n        }\n    },\n\n    /** PrivateFunction: _processRequest\n     *  _Private_ function to process a request in the queue.\n     *\n     *  This function takes requests off the queue and sends them and\n     *  restarts dead requests.\n     *\n     *  Parameters:\n     *    (Integer) i - The index of the request in the queue.\n     */\n    _processRequest: function (i) {\n        let req = this._requests[i];\n        const reqStatus = this._getRequestStatus(req, -1);\n\n        // make sure we limit the number of retries\n        if (req.sends > this._conn.maxRetries) {\n            this._conn._onDisconnectTimeout();\n            return;\n        }\n        const time_elapsed = req.age();\n        const primary_timeout = (!isNaN(time_elapsed) && time_elapsed > Math.floor(Strophe.TIMEOUT * this.wait));\n        const secondary_timeout = (req.dead !== null && req.timeDead() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait));\n        const server_error = (req.xhr.readyState === 4 && (reqStatus < 1 || reqStatus >= 500));\n\n        if (primary_timeout || secondary_timeout || server_error) {\n            if (secondary_timeout) {\n                Strophe.error(`Request ${this._requests[i].id} timed out (secondary), restarting`);\n            }\n            req.abort = true;\n            req.xhr.abort();\n            // setting to null fails on IE6, so set to empty function\n            req.xhr.onreadystatechange = function () {};\n            this._requests[i] = new Strophe.Request(req.xmlData, req.origFunc, req.rid, req.sends);\n            req = this._requests[i];\n        }\n\n        if (req.xhr.readyState === 0) {\n            Strophe.debug(\"request id \"+req.id+\".\"+req.sends+\" posting\");\n\n            try {\n                const content_type = this._conn.options.contentType || \"text/xml; charset=utf-8\";\n                req.xhr.open(\"POST\", this._conn.service, this._conn.options.sync ? false : true);\n                if (typeof req.xhr.setRequestHeader !== 'undefined') {\n                    // IE9 doesn't have setRequestHeader\n                    req.xhr.setRequestHeader(\"Content-Type\", content_type);\n                }\n                if (this._conn.options.withCredentials) {\n                    req.xhr.withCredentials = true;\n                }\n            } catch (e2) {\n                Strophe.error(\"XHR open failed: \" + e2.toString());\n                if (!this._conn.connected) {\n                    this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"bad-service\");\n                }\n                this._conn.disconnect();\n                return;\n            }\n\n            // Fires the XHR request -- may be invoked immediately\n            // or on a gradually expanding retry window for reconnects\n            const sendFunc = () => {\n                req.date = new Date();\n                if (self._conn.options.customHeaders){\n                    const headers = self._conn.options.customHeaders;\n                    for (const header in headers) {\n                        if (Object.prototype.hasOwnProperty.call(headers, header)) {\n                            req.xhr.setRequestHeader(header, headers[header]);\n                        }\n                    }\n                }\n                req.xhr.send(req.data);\n            };\n\n            // Implement progressive backoff for reconnects --\n            // First retry (send === 1) should also be instantaneous\n            if (req.sends > 1) {\n                // Using a cube of the retry number creates a nicely\n                // expanding retry window\n                const backoff = Math.min(Math.floor(Strophe.TIMEOUT * this.wait),\n                                       Math.pow(req.sends, 3)) * 1000;\n                setTimeout(function() {\n                    // XXX: setTimeout should be called only with function expressions (23974bc1)\n                    sendFunc();\n                }, backoff);\n            } else {\n                sendFunc();\n            }\n\n            req.sends++;\n\n            if (this._conn.xmlOutput !== Strophe.Connection.prototype.xmlOutput) {\n                if (req.xmlData.nodeName === this.strip && req.xmlData.childNodes.length) {\n                    this._conn.xmlOutput(req.xmlData.childNodes[0]);\n                } else {\n                    this._conn.xmlOutput(req.xmlData);\n                }\n            }\n            if (this._conn.rawOutput !== Strophe.Connection.prototype.rawOutput) {\n                this._conn.rawOutput(req.data);\n            }\n        } else {\n            Strophe.debug(\"_processRequest: \" +\n                          (i === 0 ? \"first\" : \"second\") +\n                          \" request has readyState of \" +\n                          req.xhr.readyState);\n        }\n    },\n\n    /** PrivateFunction: _removeRequest\n     *  _Private_ function to remove a request from the queue.\n     *\n     *  Parameters:\n     *    (Strophe.Request) req - The request to remove.\n     */\n    _removeRequest: function (req) {\n        Strophe.debug(\"removing request\");\n        for (let i=this._requests.length - 1; i>=0; i--) {\n            if (req === this._requests[i]) {\n                this._requests.splice(i, 1);\n            }\n        }\n        // IE6 fails on setting to null, so set to empty function\n        req.xhr.onreadystatechange = function () {};\n        this._throttledRequestHandler();\n    },\n\n    /** PrivateFunction: _restartRequest\n     *  _Private_ function to restart a request that is presumed dead.\n     *\n     *  Parameters:\n     *    (Integer) i - The index of the request in the queue.\n     */\n    _restartRequest: function (i) {\n        const req = this._requests[i];\n        if (req.dead === null) {\n            req.dead = new Date();\n        }\n        this._processRequest(i);\n    },\n\n    /** PrivateFunction: _reqToData\n     * _Private_ function to get a stanza out of a request.\n     *\n     * Tries to extract a stanza out of a Request Object.\n     * When this fails the current connection will be disconnected.\n     *\n     *  Parameters:\n     *    (Object) req - The Request.\n     *\n     *  Returns:\n     *    The stanza that was passed.\n     */\n    _reqToData: function (req) {\n        try {\n            return req.getResponse();\n        } catch (e) {\n            if (e.message !== \"parsererror\") { throw e; }\n            this._conn.disconnect(\"strophe-parsererror\");\n        }\n    },\n\n    /** PrivateFunction: _sendTerminate\n     *  _Private_ function to send initial disconnect sequence.\n     *\n     *  This is the first step in a graceful disconnect.  It sends\n     *  the BOSH server a terminate body and includes an unavailable\n     *  presence if authentication has completed.\n     */\n    _sendTerminate: function (pres) {\n        Strophe.info(\"_sendTerminate was called\");\n        const body = this._buildBody().attrs({type: \"terminate\"});\n        if (pres) {\n            body.cnode(pres.tree());\n        }\n        const req = new Strophe.Request(\n            body.tree(),\n            this._onRequestStateChange.bind(this, this._conn._dataRecv.bind(this._conn)),\n            body.tree().getAttribute(\"rid\")\n        );\n        this._requests.push(req);\n        this._throttledRequestHandler();\n    },\n\n    /** PrivateFunction: _send\n     *  _Private_ part of the Connection.send function for BOSH\n     *\n     * Just triggers the RequestHandler to send the messages that are in the queue\n     */\n    _send: function () {\n        clearTimeout(this._conn._idleTimeout);\n        this._throttledRequestHandler();\n        this._conn._idleTimeout = setTimeout(() => this._conn._onIdle(), 100);\n    },\n\n    /** PrivateFunction: _sendRestart\n     *\n     *  Send an xmpp:restart stanza.\n     */\n    _sendRestart: function () {\n        this._throttledRequestHandler();\n        clearTimeout(this._conn._idleTimeout);\n    },\n\n    /** PrivateFunction: _throttledRequestHandler\n     *  _Private_ function to throttle requests to the connection window.\n     *\n     *  This function makes sure we don't send requests so fast that the\n     *  request ids overflow the connection window in the case that one\n     *  request died.\n     */\n    _throttledRequestHandler: function () {\n        if (!this._requests) {\n            Strophe.debug(\"_throttledRequestHandler called with \" +\n                          \"undefined requests\");\n        } else {\n            Strophe.debug(\"_throttledRequestHandler called with \" +\n                          this._requests.length + \" requests\");\n        }\n\n        if (!this._requests || this._requests.length === 0) {\n            return;\n        }\n\n        if (this._requests.length > 0) {\n            this._processRequest(0);\n        }\n\n        if (this._requests.length > 1 &&\n            Math.abs(this._requests[0].rid -\n                     this._requests[1].rid) < this.window) {\n            this._processRequest(1);\n        }\n    }\n};\n","/*\n    This program is distributed under the terms of the MIT license.\n    Please see the LICENSE file for details.\n\n    Copyright 2006-2018, OGG, LLC\n*/\n/*global define, document, sessionStorage, setTimeout, clearTimeout, ActiveXObject, DOMParser, btoa, atob, module */\n\nimport MD5 from 'md5';\nimport SHA1 from 'sha1';\nimport utils from 'utils';\n\n/** Function: $build\n *  Create a Strophe.Builder.\n *  This is an alias for 'new Strophe.Builder(name, attrs)'.\n *\n *  Parameters:\n *    (String) name - The root element name.\n *    (Object) attrs - The attributes for the root element in object notation.\n *\n *  Returns:\n *    A new Strophe.Builder object.\n */\nexport function $build(name, attrs) {\n    return new Strophe.Builder(name, attrs);\n}\n\n/** Function: $msg\n *  Create a Strophe.Builder with a <message/> element as the root.\n *\n *  Parameters:\n *    (Object) attrs - The <message/> element attributes in object notation.\n *\n *  Returns:\n *    A new Strophe.Builder object.\n */\nexport function $msg(attrs) {\n    return new Strophe.Builder(\"message\", attrs);\n}\n\n/** Function: $iq\n *  Create a Strophe.Builder with an <iq/> element as the root.\n *\n *  Parameters:\n *    (Object) attrs - The <iq/> element attributes in object notation.\n *\n *  Returns:\n *    A new Strophe.Builder object.\n */\nexport function $iq(attrs) {\n    return new Strophe.Builder(\"iq\", attrs);\n}\n\n/** Function: $pres\n *  Create a Strophe.Builder with a <presence/> element as the root.\n *\n *  Parameters:\n *    (Object) attrs - The <presence/> element attributes in object notation.\n *\n *  Returns:\n *    A new Strophe.Builder object.\n */\nexport function $pres(attrs) {\n    return new Strophe.Builder(\"presence\", attrs);\n}\n\n/** Class: Strophe\n *  An object container for all Strophe library functions.\n *\n *  This class is just a container for all the objects and constants\n *  used in the library.  It is not meant to be instantiated, but to\n *  provide a namespace for library objects, constants, and functions.\n */\nexport const Strophe = {\n    /** Constant: VERSION */\n    VERSION: \"@VERSION@\",\n\n    /** Constants: XMPP Namespace Constants\n     *  Common namespace constants from the XMPP RFCs and XEPs.\n     *\n     *  NS.HTTPBIND - HTTP BIND namespace from XEP 124.\n     *  NS.BOSH - BOSH namespace from XEP 206.\n     *  NS.CLIENT - Main XMPP client namespace.\n     *  NS.AUTH - Legacy authentication namespace.\n     *  NS.ROSTER - Roster operations namespace.\n     *  NS.PROFILE - Profile namespace.\n     *  NS.DISCO_INFO - Service discovery info namespace from XEP 30.\n     *  NS.DISCO_ITEMS - Service discovery items namespace from XEP 30.\n     *  NS.MUC - Multi-User Chat namespace from XEP 45.\n     *  NS.SASL - XMPP SASL namespace from RFC 3920.\n     *  NS.STREAM - XMPP Streams namespace from RFC 3920.\n     *  NS.BIND - XMPP Binding namespace from RFC 3920.\n     *  NS.SESSION - XMPP Session namespace from RFC 3920.\n     *  NS.XHTML_IM - XHTML-IM namespace from XEP 71.\n     *  NS.XHTML - XHTML body namespace from XEP 71.\n     */\n    NS: {\n        HTTPBIND: \"http://jabber.org/protocol/httpbind\",\n        BOSH: \"urn:xmpp:xbosh\",\n        CLIENT: \"jabber:client\",\n        AUTH: \"jabber:iq:auth\",\n        ROSTER: \"jabber:iq:roster\",\n        PROFILE: \"jabber:iq:profile\",\n        DISCO_INFO: \"http://jabber.org/protocol/disco#info\",\n        DISCO_ITEMS: \"http://jabber.org/protocol/disco#items\",\n        MUC: \"http://jabber.org/protocol/muc\",\n        SASL: \"urn:ietf:params:xml:ns:xmpp-sasl\",\n        STREAM: \"http://etherx.jabber.org/streams\",\n        FRAMING: \"urn:ietf:params:xml:ns:xmpp-framing\",\n        BIND: \"urn:ietf:params:xml:ns:xmpp-bind\",\n        SESSION: \"urn:ietf:params:xml:ns:xmpp-session\",\n        VERSION: \"jabber:iq:version\",\n        STANZAS: \"urn:ietf:params:xml:ns:xmpp-stanzas\",\n        XHTML_IM: \"http://jabber.org/protocol/xhtml-im\",\n        XHTML: \"http://www.w3.org/1999/xhtml\"\n    },\n\n    /** Constants: XHTML_IM Namespace\n     *  contains allowed tags, tag attributes, and css properties.\n     *  Used in the createHtml function to filter incoming html into the allowed XHTML-IM subset.\n     *  See http://xmpp.org/extensions/xep-0071.html#profile-summary for the list of recommended\n     *  allowed tags and their attributes.\n     */\n    XHTML: {\n        tags: ['a','blockquote','br','cite','em','img','li','ol','p','span','strong','ul','body'],\n        attributes: {\n            'a':          ['href'],\n            'blockquote': ['style'],\n            'br':         [],\n            'cite':       ['style'],\n            'em':         [],\n            'img':        ['src', 'alt', 'style', 'height', 'width'],\n            'li':         ['style'],\n            'ol':         ['style'],\n            'p':          ['style'],\n            'span':       ['style'],\n            'strong':     [],\n            'ul':         ['style'],\n            'body':       []\n        },\n        css: ['background-color','color','font-family','font-size','font-style','font-weight','margin-left','margin-right','text-align','text-decoration'],\n        /** Function: XHTML.validTag\n         *\n         * Utility method to determine whether a tag is allowed\n         * in the XHTML_IM namespace.\n         *\n         * XHTML tag names are case sensitive and must be lower case.\n         */\n        validTag: function(tag) {\n            for (let i=0; i<Strophe.XHTML.tags.length; i++) {\n                if (tag === Strophe.XHTML.tags[i]) {\n                    return true;\n                }\n            }\n            return false;\n        },\n        /** Function: XHTML.validAttribute\n         *\n         * Utility method to determine whether an attribute is allowed\n         * as recommended per XEP-0071\n         *\n         * XHTML attribute names are case sensitive and must be lower case.\n         */\n        validAttribute: function(tag, attribute) {\n            if (typeof Strophe.XHTML.attributes[tag] !== 'undefined' && Strophe.XHTML.attributes[tag].length > 0) {\n                for (let i=0; i<Strophe.XHTML.attributes[tag].length; i++) {\n                    if (attribute === Strophe.XHTML.attributes[tag][i]) {\n                        return true;\n                    }\n                }\n            }\n        return false;\n        },\n        validCSS: function(style) {\n            for (let i=0; i<Strophe.XHTML.css.length; i++) {\n                if (style === Strophe.XHTML.css[i]) {\n                    return true;\n                }\n            }\n            return false;\n        }\n    },\n\n    /** Constants: Connection Status Constants\n     *  Connection status constants for use by the connection handler\n     *  callback.\n     *\n     *  Status.ERROR - An error has occurred\n     *  Status.CONNECTING - The connection is currently being made\n     *  Status.CONNFAIL - The connection attempt failed\n     *  Status.AUTHENTICATING - The connection is authenticating\n     *  Status.AUTHFAIL - The authentication attempt failed\n     *  Status.CONNECTED - The connection has succeeded\n     *  Status.DISCONNECTED - The connection has been terminated\n     *  Status.DISCONNECTING - The connection is currently being terminated\n     *  Status.ATTACHED - The connection has been attached\n     *  Status.REDIRECT - The connection has been redirected\n     *  Status.CONNTIMEOUT - The connection has timed out\n     */\n    Status: {\n        ERROR: 0,\n        CONNECTING: 1,\n        CONNFAIL: 2,\n        AUTHENTICATING: 3,\n        AUTHFAIL: 4,\n        CONNECTED: 5,\n        DISCONNECTED: 6,\n        DISCONNECTING: 7,\n        ATTACHED: 8,\n        REDIRECT: 9,\n        CONNTIMEOUT: 10\n    },\n\n    ErrorCondition: {\n        BAD_FORMAT: \"bad-format\",\n        CONFLICT: \"conflict\",\n        MISSING_JID_NODE: \"x-strophe-bad-non-anon-jid\",\n        NO_AUTH_MECH: \"no-auth-mech\",\n        UNKNOWN_REASON: \"unknown\",\n    },\n\n    /** Constants: Log Level Constants\n     *  Logging level indicators.\n     *\n     *  LogLevel.DEBUG - Debug output\n     *  LogLevel.INFO - Informational output\n     *  LogLevel.WARN - Warnings\n     *  LogLevel.ERROR - Errors\n     *  LogLevel.FATAL - Fatal errors\n     */\n    LogLevel: {\n        DEBUG: 0,\n        INFO: 1,\n        WARN: 2,\n        ERROR: 3,\n        FATAL: 4\n    },\n\n    /** PrivateConstants: DOM Element Type Constants\n     *  DOM element types.\n     *\n     *  ElementType.NORMAL - Normal element.\n     *  ElementType.TEXT - Text data element.\n     *  ElementType.FRAGMENT - XHTML fragment element.\n     */\n    ElementType: {\n        NORMAL: 1,\n        TEXT: 3,\n        CDATA: 4,\n        FRAGMENT: 11\n    },\n\n    /** PrivateConstants: Timeout Values\n     *  Timeout values for error states.  These values are in seconds.\n     *  These should not be changed unless you know exactly what you are\n     *  doing.\n     *\n     *  TIMEOUT - Timeout multiplier. A waiting request will be considered\n     *      failed after Math.floor(TIMEOUT * wait) seconds have elapsed.\n     *      This defaults to 1.1, and with default wait, 66 seconds.\n     *  SECONDARY_TIMEOUT - Secondary timeout multiplier. In cases where\n     *      Strophe can detect early failure, it will consider the request\n     *      failed if it doesn't return after\n     *      Math.floor(SECONDARY_TIMEOUT * wait) seconds have elapsed.\n     *      This defaults to 0.1, and with default wait, 6 seconds.\n     */\n    TIMEOUT: 1.1,\n    SECONDARY_TIMEOUT: 0.1,\n\n    /** Function: addNamespace\n     *  This function is used to extend the current namespaces in\n     *  Strophe.NS.  It takes a key and a value with the key being the\n     *  name of the new namespace, with its actual value.\n     *  For example:\n     *  Strophe.addNamespace('PUBSUB', \"http://jabber.org/protocol/pubsub\");\n     *\n     *  Parameters:\n     *    (String) name - The name under which the namespace will be\n     *      referenced under Strophe.NS\n     *    (String) value - The actual namespace.\n     */\n    addNamespace: function (name, value) {\n        Strophe.NS[name] = value;\n    },\n\n    /** Function: forEachChild\n     *  Map a function over some or all child elements of a given element.\n     *\n     *  This is a small convenience function for mapping a function over\n     *  some or all of the children of an element.  If elemName is null, all\n     *  children will be passed to the function, otherwise only children\n     *  whose tag names match elemName will be passed.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The element to operate on.\n     *    (String) elemName - The child element tag name filter.\n     *    (Function) func - The function to apply to each child.  This\n     *      function should take a single argument, a DOM element.\n     */\n    forEachChild: function (elem, elemName, func) {\n        for (let i=0; i<elem.childNodes.length; i++) {\n            const childNode = elem.childNodes[i];\n            if (childNode.nodeType === Strophe.ElementType.NORMAL &&\n                (!elemName || this.isTagEqual(childNode, elemName))) {\n                func(childNode);\n            }\n        }\n    },\n\n    /** Function: isTagEqual\n     *  Compare an element's tag name with a string.\n     *\n     *  This function is case sensitive.\n     *\n     *  Parameters:\n     *    (XMLElement) el - A DOM element.\n     *    (String) name - The element name.\n     *\n     *  Returns:\n     *    true if the element's tag name matches _el_, and false\n     *    otherwise.\n     */\n    isTagEqual: function (el, name) {\n        return el.tagName === name;\n    },\n\n    /** PrivateVariable: _xmlGenerator\n     *  _Private_ variable that caches a DOM document to\n     *  generate elements.\n     */\n    _xmlGenerator: null,\n\n    /** PrivateFunction: _makeGenerator\n     *  _Private_ function that creates a dummy XML DOM document to serve as\n     *  an element and text node generator.\n     */\n    _makeGenerator: function () {\n        let doc;\n        // IE9 does implement createDocument(); however, using it will cause the browser to leak memory on page unload.\n        // Here, we test for presence of createDocument() plus IE's proprietary documentMode attribute, which would be\n                // less than 10 in the case of IE9 and below.\n        if (document.implementation.createDocument === undefined ||\n                        document.implementation.createDocument && document.documentMode && document.documentMode < 10) {\n            doc = this._getIEXmlDom();\n            doc.appendChild(doc.createElement('strophe'));\n        } else {\n            doc = document.implementation\n                .createDocument('jabber:client', 'strophe', null);\n        }\n        return doc;\n    },\n\n    /** Function: xmlGenerator\n     *  Get the DOM document to generate elements.\n     *\n     *  Returns:\n     *    The currently used DOM document.\n     */\n    xmlGenerator: function () {\n        if (!Strophe._xmlGenerator) {\n            Strophe._xmlGenerator = Strophe._makeGenerator();\n        }\n        return Strophe._xmlGenerator;\n    },\n\n    /** PrivateFunction: _getIEXmlDom\n     *  Gets IE xml doc object\n     *\n     *  Returns:\n     *    A Microsoft XML DOM Object\n     *  See Also:\n     *    http://msdn.microsoft.com/en-us/library/ms757837%28VS.85%29.aspx\n     */\n    _getIEXmlDom : function() {\n        let doc = null;\n        const docStrings = [\n            \"Msxml2.DOMDocument.6.0\",\n            \"Msxml2.DOMDocument.5.0\",\n            \"Msxml2.DOMDocument.4.0\",\n            \"MSXML2.DOMDocument.3.0\",\n            \"MSXML2.DOMDocument\",\n            \"MSXML.DOMDocument\",\n            \"Microsoft.XMLDOM\"\n        ];\n\n        for (let d=0; d<docStrings.length; d++) {\n            if (doc === null) {\n                try {\n                    doc = new ActiveXObject(docStrings[d]);\n                } catch (e) {\n                    doc = null;\n                }\n            } else {\n                break;\n            }\n        }\n        return doc;\n    },\n\n    /** Function: xmlElement\n     *  Create an XML DOM element.\n     *\n     *  This function creates an XML DOM element correctly across all\n     *  implementations. Note that these are not HTML DOM elements, which\n     *  aren't appropriate for XMPP stanzas.\n     *\n     *  Parameters:\n     *    (String) name - The name for the element.\n     *    (Array|Object) attrs - An optional array or object containing\n     *      key/value pairs to use as element attributes. The object should\n     *      be in the format {'key': 'value'} or {key: 'value'}. The array\n     *      should have the format [['key1', 'value1'], ['key2', 'value2']].\n     *    (String) text - The text child data for the element.\n     *\n     *  Returns:\n     *    A new XML DOM element.\n     */\n    xmlElement: function (name) {\n        if (!name) { return null; }\n\n        const node = Strophe.xmlGenerator().createElement(name);\n        // FIXME: this should throw errors if args are the wrong type or\n        // there are more than two optional args\n        for (let a=1; a<arguments.length; a++) {\n            const arg = arguments[a];\n            if (!arg) { continue; }\n            if (typeof(arg) === \"string\" ||\n                typeof(arg) === \"number\") {\n                node.appendChild(Strophe.xmlTextNode(arg));\n            } else if (typeof(arg) === \"object\" &&\n                       typeof(arg.sort) === \"function\") {\n                for (let i=0; i<arg.length; i++) {\n                    const attr = arg[i];\n                    if (typeof(attr) === \"object\" &&\n                        typeof(attr.sort) === \"function\" &&\n                        attr[1] !== undefined &&\n                        attr[1] !== null) {\n                        node.setAttribute(attr[0], attr[1]);\n                    }\n                }\n            } else if (typeof(arg) === \"object\") {\n                for (const k in arg) {\n                    if (Object.prototype.hasOwnProperty.call(arg, k) && arg[k] !== undefined && arg[k] !== null) {\n                        node.setAttribute(k, arg[k]);\n                    }\n                }\n            }\n        }\n        return node;\n    },\n\n    /*  Function: xmlescape\n     *  Excapes invalid xml characters.\n     *\n     *  Parameters:\n     *     (String) text - text to escape.\n     *\n     *  Returns:\n     *      Escaped text.\n     */\n    xmlescape: function(text) {\n        text = text.replace(/\\&/g, \"&amp;\");\n        text = text.replace(/</g,  \"&lt;\");\n        text = text.replace(/>/g,  \"&gt;\");\n        text = text.replace(/'/g,  \"&apos;\");\n        text = text.replace(/\"/g,  \"&quot;\");\n        return text;\n    },\n\n    /*  Function: xmlunescape\n    *  Unexcapes invalid xml characters.\n    *\n    *  Parameters:\n    *     (String) text - text to unescape.\n    *\n    *  Returns:\n    *      Unescaped text.\n    */\n    xmlunescape: function(text) {\n        text = text.replace(/\\&amp;/g, \"&\");\n        text = text.replace(/&lt;/g,  \"<\");\n        text = text.replace(/&gt;/g,  \">\");\n        text = text.replace(/&apos;/g,  \"'\");\n        text = text.replace(/&quot;/g,  \"\\\"\");\n        return text;\n    },\n\n    /** Function: xmlTextNode\n     *  Creates an XML DOM text node.\n     *\n     *  Provides a cross implementation version of document.createTextNode.\n     *\n     *  Parameters:\n     *    (String) text - The content of the text node.\n     *\n     *  Returns:\n     *    A new XML DOM text node.\n     */\n    xmlTextNode: function (text) {\n        return Strophe.xmlGenerator().createTextNode(text);\n    },\n\n    /** Function: xmlHtmlNode\n     *  Creates an XML DOM html node.\n     *\n     *  Parameters:\n     *    (String) html - The content of the html node.\n     *\n     *  Returns:\n     *    A new XML DOM text node.\n     */\n    xmlHtmlNode: function (html) {\n        let node;\n        //ensure text is escaped\n        if (DOMParser) {\n            const parser = new DOMParser();\n            node = parser.parseFromString(html, \"text/xml\");\n        } else {\n            node = new ActiveXObject(\"Microsoft.XMLDOM\");\n            node.async=\"false\";\n            node.loadXML(html);\n        }\n        return node;\n    },\n\n    /** Function: getText\n     *  Get the concatenation of all text children of an element.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - A DOM element.\n     *\n     *  Returns:\n     *    A String with the concatenated text of all text element children.\n     */\n    getText: function (elem) {\n        if (!elem) { return null; }\n\n        let str = \"\";\n        if (elem.childNodes.length === 0 && elem.nodeType === Strophe.ElementType.TEXT) {\n            str += elem.nodeValue;\n        }\n        for (let i=0; i<elem.childNodes.length; i++) {\n            if (elem.childNodes[i].nodeType === Strophe.ElementType.TEXT) {\n                str += elem.childNodes[i].nodeValue;\n            }\n        }\n        return Strophe.xmlescape(str);\n    },\n\n    /** Function: copyElement\n     *  Copy an XML DOM element.\n     *\n     *  This function copies a DOM element and all its descendants and returns\n     *  the new copy.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - A DOM element.\n     *\n     *  Returns:\n     *    A new, copied DOM element tree.\n     */\n    copyElement: function (elem) {\n        let el;\n        if (elem.nodeType === Strophe.ElementType.NORMAL) {\n            el = Strophe.xmlElement(elem.tagName);\n\n            for (let i=0; i<elem.attributes.length; i++) {\n                el.setAttribute(elem.attributes[i].nodeName,\n                                elem.attributes[i].value);\n            }\n\n            for (let i=0; i<elem.childNodes.length; i++) {\n                el.appendChild(Strophe.copyElement(elem.childNodes[i]));\n            }\n        } else if (elem.nodeType === Strophe.ElementType.TEXT) {\n            el = Strophe.xmlGenerator().createTextNode(elem.nodeValue);\n        }\n        return el;\n    },\n\n\n    /** Function: createHtml\n     *  Copy an HTML DOM element into an XML DOM.\n     *\n     *  This function copies a DOM element and all its descendants and returns\n     *  the new copy.\n     *\n     *  Parameters:\n     *    (HTMLElement) elem - A DOM element.\n     *\n     *  Returns:\n     *    A new, copied DOM element tree.\n     */\n    createHtml: function (elem) {\n        let el;\n        if (elem.nodeType === Strophe.ElementType.NORMAL) {\n            const tag = elem.nodeName.toLowerCase(); // XHTML tags must be lower case.\n            if (Strophe.XHTML.validTag(tag)) {\n                try {\n                    el = Strophe.xmlElement(tag);\n                    for (let i=0; i < Strophe.XHTML.attributes[tag].length; i++) {\n                        const attribute = Strophe.XHTML.attributes[tag][i];\n                        let value = elem.getAttribute(attribute);\n                        if (typeof value === 'undefined' || value === null || value === '' || value === false || value === 0) {\n                            continue;\n                        }\n                        if (attribute === 'style' && typeof value === 'object' && typeof value.cssText !== 'undefined') {\n                            value = value.cssText; // we're dealing with IE, need to get CSS out\n                        }\n                        // filter out invalid css styles\n                        if (attribute === 'style') {\n                            const css = [];\n                            const cssAttrs = value.split(';');\n                            for (let j=0; j < cssAttrs.length; j++) {\n                                const attr = cssAttrs[j].split(':');\n                                const cssName = attr[0].replace(/^\\s*/, \"\").replace(/\\s*$/, \"\").toLowerCase();\n                                if(Strophe.XHTML.validCSS(cssName)) {\n                                    const cssValue = attr[1].replace(/^\\s*/, \"\").replace(/\\s*$/, \"\");\n                                    css.push(cssName + ': ' + cssValue);\n                                }\n                            }\n                            if (css.length > 0) {\n                                value = css.join('; ');\n                                el.setAttribute(attribute, value);\n                            }\n                        } else {\n                            el.setAttribute(attribute, value);\n                        }\n                    }\n                    for (let i=0; i < elem.childNodes.length; i++) {\n                        el.appendChild(Strophe.createHtml(elem.childNodes[i]));\n                    }\n                } catch(e) { // invalid elements\n                    el = Strophe.xmlTextNode('');\n                }\n            } else {\n                el = Strophe.xmlGenerator().createDocumentFragment();\n                for (let i=0; i < elem.childNodes.length; i++) {\n                    el.appendChild(Strophe.createHtml(elem.childNodes[i]));\n                }\n            }\n        } else if (elem.nodeType === Strophe.ElementType.FRAGMENT) {\n            el = Strophe.xmlGenerator().createDocumentFragment();\n            for (let i=0; i < elem.childNodes.length; i++) {\n                el.appendChild(Strophe.createHtml(elem.childNodes[i]));\n            }\n        } else if (elem.nodeType === Strophe.ElementType.TEXT) {\n            el = Strophe.xmlTextNode(elem.nodeValue);\n        }\n        return el;\n    },\n\n    /** Function: escapeNode\n     *  Escape the node part (also called local part) of a JID.\n     *\n     *  Parameters:\n     *    (String) node - A node (or local part).\n     *\n     *  Returns:\n     *    An escaped node (or local part).\n     */\n    escapeNode: function (node) {\n        if (typeof node !== \"string\") { return node; }\n        return node.replace(/^\\s+|\\s+$/g, '')\n            .replace(/\\\\/g,  \"\\\\5c\")\n            .replace(/ /g,   \"\\\\20\")\n            .replace(/\\\"/g,  \"\\\\22\")\n            .replace(/\\&/g,  \"\\\\26\")\n            .replace(/\\'/g,  \"\\\\27\")\n            .replace(/\\//g,  \"\\\\2f\")\n            .replace(/:/g,   \"\\\\3a\")\n            .replace(/</g,   \"\\\\3c\")\n            .replace(/>/g,   \"\\\\3e\")\n            .replace(/@/g,   \"\\\\40\");\n    },\n\n    /** Function: unescapeNode\n     *  Unescape a node part (also called local part) of a JID.\n     *\n     *  Parameters:\n     *    (String) node - A node (or local part).\n     *\n     *  Returns:\n     *    An unescaped node (or local part).\n     */\n    unescapeNode: function (node) {\n        if (typeof node !== \"string\") { return node; }\n        return node.replace(/\\\\20/g, \" \")\n            .replace(/\\\\22/g, '\"')\n            .replace(/\\\\26/g, \"&\")\n            .replace(/\\\\27/g, \"'\")\n            .replace(/\\\\2f/g, \"/\")\n            .replace(/\\\\3a/g, \":\")\n            .replace(/\\\\3c/g, \"<\")\n            .replace(/\\\\3e/g, \">\")\n            .replace(/\\\\40/g, \"@\")\n            .replace(/\\\\5c/g, \"\\\\\");\n    },\n\n    /** Function: getNodeFromJid\n     *  Get the node portion of a JID String.\n     *\n     *  Parameters:\n     *    (String) jid - A JID.\n     *\n     *  Returns:\n     *    A String containing the node.\n     */\n    getNodeFromJid: function (jid) {\n        if (jid.indexOf(\"@\") < 0) { return null; }\n        return jid.split(\"@\")[0];\n    },\n\n    /** Function: getDomainFromJid\n     *  Get the domain portion of a JID String.\n     *\n     *  Parameters:\n     *    (String) jid - A JID.\n     *\n     *  Returns:\n     *    A String containing the domain.\n     */\n    getDomainFromJid: function (jid) {\n        const bare = Strophe.getBareJidFromJid(jid);\n        if (bare.indexOf(\"@\") < 0) {\n            return bare;\n        } else {\n            const parts = bare.split(\"@\");\n            parts.splice(0, 1);\n            return parts.join('@');\n        }\n    },\n\n    /** Function: getResourceFromJid\n     *  Get the resource portion of a JID String.\n     *\n     *  Parameters:\n     *    (String) jid - A JID.\n     *\n     *  Returns:\n     *    A String containing the resource.\n     */\n    getResourceFromJid: function (jid) {\n        const s = jid.split(\"/\");\n        if (s.length < 2) { return null; }\n        s.splice(0, 1);\n        return s.join('/');\n    },\n\n    /** Function: getBareJidFromJid\n     *  Get the bare JID from a JID String.\n     *\n     *  Parameters:\n     *    (String) jid - A JID.\n     *\n     *  Returns:\n     *    A String containing the bare JID.\n     */\n    getBareJidFromJid: function (jid) {\n        return jid ? jid.split(\"/\")[0] : null;\n    },\n\n    /** PrivateFunction: _handleError\n     *  _Private_ function that properly logs an error to the console\n     */\n    _handleError: function (e) {\n        if (typeof e.stack !== \"undefined\") {\n            Strophe.fatal(e.stack);\n        }\n        if (e.sourceURL) {\n            Strophe.fatal(\"error: \" + this.handler + \" \" + e.sourceURL + \":\" +\n                          e.line + \" - \" + e.name + \": \" + e.message);\n        } else if (e.fileName) {\n            Strophe.fatal(\"error: \" + this.handler + \" \" +\n                          e.fileName + \":\" + e.lineNumber + \" - \" +\n                          e.name + \": \" + e.message);\n        } else {\n            Strophe.fatal(\"error: \" + e.message);\n        }\n    },\n\n    /** Function: log\n     *  User overrideable logging function.\n     *\n     *  This function is called whenever the Strophe library calls any\n     *  of the logging functions.  The default implementation of this\n     *  function logs only fatal errors.  If client code wishes to handle the logging\n     *  messages, it should override this with\n     *  > Strophe.log = function (level, msg) {\n     *  >   (user code here)\n     *  > };\n     *\n     *  Please note that data sent and received over the wire is logged\n     *  via Strophe.Connection.rawInput() and Strophe.Connection.rawOutput().\n     *\n     *  The different levels and their meanings are\n     *\n     *    DEBUG - Messages useful for debugging purposes.\n     *    INFO - Informational messages.  This is mostly information like\n     *      'disconnect was called' or 'SASL auth succeeded'.\n     *    WARN - Warnings about potential problems.  This is mostly used\n     *      to report transient connection errors like request timeouts.\n     *    ERROR - Some error occurred.\n     *    FATAL - A non-recoverable fatal error occurred.\n     *\n     *  Parameters:\n     *    (Integer) level - The log level of the log message.  This will\n     *      be one of the values in Strophe.LogLevel.\n     *    (String) msg - The log message.\n     */\n    log: function (level, msg) {\n        if (level === this.LogLevel.FATAL &&\n            typeof window.console === 'object' &&\n            typeof window.console.error === 'function') {\n            window.console.error(msg);\n        }\n    },\n\n    /** Function: debug\n     *  Log a message at the Strophe.LogLevel.DEBUG level.\n     *\n     *  Parameters:\n     *    (String) msg - The log message.\n     */\n    debug: function(msg) {\n        this.log(this.LogLevel.DEBUG, msg);\n    },\n\n    /** Function: info\n     *  Log a message at the Strophe.LogLevel.INFO level.\n     *\n     *  Parameters:\n     *    (String) msg - The log message.\n     */\n    info: function (msg) {\n        this.log(this.LogLevel.INFO, msg);\n    },\n\n    /** Function: warn\n     *  Log a message at the Strophe.LogLevel.WARN level.\n     *\n     *  Parameters:\n     *    (String) msg - The log message.\n     */\n    warn: function (msg) {\n        this.log(this.LogLevel.WARN, msg);\n    },\n\n    /** Function: error\n     *  Log a message at the Strophe.LogLevel.ERROR level.\n     *\n     *  Parameters:\n     *    (String) msg - The log message.\n     */\n    error: function (msg) {\n        this.log(this.LogLevel.ERROR, msg);\n    },\n\n    /** Function: fatal\n     *  Log a message at the Strophe.LogLevel.FATAL level.\n     *\n     *  Parameters:\n     *    (String) msg - The log message.\n     */\n    fatal: function (msg) {\n        this.log(this.LogLevel.FATAL, msg);\n    },\n\n    /** Function: serialize\n     *  Render a DOM element and all descendants to a String.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - A DOM element.\n     *\n     *  Returns:\n     *    The serialized element tree as a String.\n     */\n    serialize: function (elem) {\n        if (!elem) { return null; }\n        if (typeof(elem.tree) === \"function\") {\n            elem = elem.tree();\n        }\n        const nodeName = elem.getAttribute(\"_realname\") ? elem.getAttribute(\"_realname\") : elem.nodeName;\n        let result = \"<\" + nodeName;\n        for (let i=0; i < elem.attributes.length; i++) {\n             if (elem.attributes[i].nodeName !== \"_realname\") {\n               result += \" \" + elem.attributes[i].nodeName +\n                   \"='\" + Strophe.xmlescape(elem.attributes[i].value) + \"'\";\n             }\n        }\n\n        if (elem.childNodes.length > 0) {\n            result += \">\";\n            for (let i=0; i < elem.childNodes.length; i++) {\n                const child = elem.childNodes[i];\n                switch (child.nodeType) {\n                  case Strophe.ElementType.NORMAL:\n                    // normal element, so recurse\n                    result += Strophe.serialize(child);\n                    break;\n                  case Strophe.ElementType.TEXT:\n                    // text element to escape values\n                    result += Strophe.xmlescape(child.nodeValue);\n                    break;\n                  case Strophe.ElementType.CDATA:\n                    // cdata section so don't escape values\n                    result += \"<![CDATA[\"+child.nodeValue+\"]]>\";\n                }\n            }\n            result += \"</\" + nodeName + \">\";\n        } else {\n            result += \"/>\";\n        }\n        return result;\n    },\n\n    /** PrivateVariable: _requestId\n     *  _Private_ variable that keeps track of the request ids for\n     *  connections.\n     */\n    _requestId: 0,\n\n    /** PrivateVariable: Strophe.connectionPlugins\n     *  _Private_ variable Used to store plugin names that need\n     *  initialization on Strophe.Connection construction.\n     */\n    _connectionPlugins: {},\n\n    /** Function: addConnectionPlugin\n     *  Extends the Strophe.Connection object with the given plugin.\n     *\n     *  Parameters:\n     *    (String) name - The name of the extension.\n     *    (Object) ptype - The plugin's prototype.\n     */\n    addConnectionPlugin: function (name, ptype) {\n        Strophe._connectionPlugins[name] = ptype;\n    }\n};\n\n/** Class: Strophe.Builder\n *  XML DOM builder.\n *\n *  This object provides an interface similar to JQuery but for building\n *  DOM elements easily and rapidly.  All the functions except for toString()\n *  and tree() return the object, so calls can be chained.  Here's an\n *  example using the $iq() builder helper.\n *  > $iq({to: 'you', from: 'me', type: 'get', id: '1'})\n *  >     .c('query', {xmlns: 'strophe:example'})\n *  >     .c('example')\n *  >     .toString()\n *\n *  The above generates this XML fragment\n *  > <iq to='you' from='me' type='get' id='1'>\n *  >   <query xmlns='strophe:example'>\n *  >     <example/>\n *  >   </query>\n *  > </iq>\n *  The corresponding DOM manipulations to get a similar fragment would be\n *  a lot more tedious and probably involve several helper variables.\n *\n *  Since adding children makes new operations operate on the child, up()\n *  is provided to traverse up the tree.  To add two children, do\n *  > builder.c('child1', ...).up().c('child2', ...)\n *  The next operation on the Builder will be relative to the second child.\n */\n\n/** Constructor: Strophe.Builder\n *  Create a Strophe.Builder object.\n *\n *  The attributes should be passed in object notation.  For example\n *  > let b = new Builder('message', {to: 'you', from: 'me'});\n *  or\n *  > let b = new Builder('messsage', {'xml:lang': 'en'});\n *\n *  Parameters:\n *    (String) name - The name of the root element.\n *    (Object) attrs - The attributes for the root element in object notation.\n *\n *  Returns:\n *    A new Strophe.Builder.\n */\nStrophe.Builder = function (name, attrs) {\n    // Set correct namespace for jabber:client elements\n    if (name === \"presence\" || name === \"message\" || name === \"iq\") {\n        if (attrs && !attrs.xmlns) {\n            attrs.xmlns = Strophe.NS.CLIENT;\n        } else if (!attrs) {\n            attrs = {xmlns: Strophe.NS.CLIENT};\n        }\n    }\n    // Holds the tree being built.\n    this.nodeTree = Strophe.xmlElement(name, attrs);\n    // Points to the current operation node.\n    this.node = this.nodeTree;\n};\n\nStrophe.Builder.prototype = {\n    /** Function: tree\n     *  Return the DOM tree.\n     *\n     *  This function returns the current DOM tree as an element object.  This\n     *  is suitable for passing to functions like Strophe.Connection.send().\n     *\n     *  Returns:\n     *    The DOM tree as a element object.\n     */\n    tree: function () {\n        return this.nodeTree;\n    },\n\n    /** Function: toString\n     *  Serialize the DOM tree to a String.\n     *\n     *  This function returns a string serialization of the current DOM\n     *  tree.  It is often used internally to pass data to a\n     *  Strophe.Request object.\n     *\n     *  Returns:\n     *    The serialized DOM tree in a String.\n     */\n    toString: function () {\n        return Strophe.serialize(this.nodeTree);\n    },\n\n    /** Function: up\n     *  Make the current parent element the new current element.\n     *\n     *  This function is often used after c() to traverse back up the tree.\n     *  For example, to add two children to the same element\n     *  > builder.c('child1', {}).up().c('child2', {});\n     *\n     *  Returns:\n     *    The Stophe.Builder object.\n     */\n    up: function () {\n        this.node = this.node.parentNode;\n        return this;\n    },\n\n    /** Function: root\n     *  Make the root element the new current element.\n     *\n     *  When at a deeply nested element in the tree, this function can be used\n     *  to jump back to the root of the tree, instead of having to repeatedly\n     *  call up().\n     *\n     *  Returns:\n     *    The Stophe.Builder object.\n     */\n    root: function () {\n        this.node = this.nodeTree;\n        return this;\n    },\n\n    /** Function: attrs\n     *  Add or modify attributes of the current element.\n     *\n     *  The attributes should be passed in object notation.  This function\n     *  does not move the current element pointer.\n     *\n     *  Parameters:\n     *    (Object) moreattrs - The attributes to add/modify in object notation.\n     *\n     *  Returns:\n     *    The Strophe.Builder object.\n     */\n    attrs: function (moreattrs) {\n        for (const k in moreattrs) {\n            if (Object.prototype.hasOwnProperty.call(moreattrs, k)) {\n                if (moreattrs[k] === undefined) {\n                    this.node.removeAttribute(k);\n                } else {\n                    this.node.setAttribute(k, moreattrs[k]);\n                }\n            }\n        }\n        return this;\n    },\n\n    /** Function: c\n     *  Add a child to the current element and make it the new current\n     *  element.\n     *\n     *  This function moves the current element pointer to the child,\n     *  unless text is provided.  If you need to add another child, it\n     *  is necessary to use up() to go back to the parent in the tree.\n     *\n     *  Parameters:\n     *    (String) name - The name of the child.\n     *    (Object) attrs - The attributes of the child in object notation.\n     *    (String) text - The text to add to the child.\n     *\n     *  Returns:\n     *    The Strophe.Builder object.\n     */\n    c: function (name, attrs, text) {\n        const child = Strophe.xmlElement(name, attrs, text);\n        this.node.appendChild(child);\n        if (typeof text !== \"string\" && typeof text !==\"number\") {\n            this.node = child;\n        }\n        return this;\n    },\n\n    /** Function: cnode\n     *  Add a child to the current element and make it the new current\n     *  element.\n     *\n     *  This function is the same as c() except that instead of using a\n     *  name and an attributes object to create the child it uses an\n     *  existing DOM element object.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - A DOM element.\n     *\n     *  Returns:\n     *    The Strophe.Builder object.\n     */\n    cnode: function (elem) {\n        let impNode;\n        const xmlGen = Strophe.xmlGenerator();\n        try {\n            impNode = (xmlGen.importNode !== undefined);\n        } catch (e) {\n            impNode = false;\n        }\n        const newElem = impNode ? xmlGen.importNode(elem, true) : Strophe.copyElement(elem);\n        this.node.appendChild(newElem);\n        this.node = newElem;\n        return this;\n    },\n\n    /** Function: t\n     *  Add a child text element.\n     *\n     *  This *does not* make the child the new current element since there\n     *  are no children of text elements.\n     *\n     *  Parameters:\n     *    (String) text - The text data to append to the current element.\n     *\n     *  Returns:\n     *    The Strophe.Builder object.\n     */\n    t: function (text) {\n        const child = Strophe.xmlTextNode(text);\n        this.node.appendChild(child);\n        return this;\n    },\n\n    /** Function: h\n     *  Replace current element contents with the HTML passed in.\n     *\n     *  This *does not* make the child the new current element\n     *\n     *  Parameters:\n     *    (String) html - The html to insert as contents of current element.\n     *\n     *  Returns:\n     *    The Strophe.Builder object.\n     */\n    h: function (html) {\n        const fragment = document.createElement('body');\n        // force the browser to try and fix any invalid HTML tags\n        fragment.innerHTML = html;\n        // copy cleaned html into an xml dom\n        const xhtml = Strophe.createHtml(fragment);\n        while (xhtml.childNodes.length > 0) {\n            this.node.appendChild(xhtml.childNodes[0]);\n        }\n        return this;\n    }\n};\n\n/** PrivateClass: Strophe.Handler\n *  _Private_ helper class for managing stanza handlers.\n *\n *  A Strophe.Handler encapsulates a user provided callback function to be\n *  executed when matching stanzas are received by the connection.\n *  Handlers can be either one-off or persistant depending on their\n *  return value. Returning true will cause a Handler to remain active, and\n *  returning false will remove the Handler.\n *\n *  Users will not use Strophe.Handler objects directly, but instead they\n *  will use Strophe.Connection.addHandler() and\n *  Strophe.Connection.deleteHandler().\n */\n\n/** PrivateConstructor: Strophe.Handler\n *  Create and initialize a new Strophe.Handler.\n *\n *  Parameters:\n *    (Function) handler - A function to be executed when the handler is run.\n *    (String) ns - The namespace to match.\n *    (String) name - The element name to match.\n *    (String) type - The element type to match.\n *    (String) id - The element id attribute to match.\n *    (String) from - The element from attribute to match.\n *    (Object) options - Handler options\n *\n *  Returns:\n *    A new Strophe.Handler object.\n */\nStrophe.Handler = function (handler, ns, name, type, id, from, options) {\n    this.handler = handler;\n    this.ns = ns;\n    this.name = name;\n    this.type = type;\n    this.id = id;\n    this.options = options || {'matchBareFromJid': false, 'ignoreNamespaceFragment': false};\n    // BBB: Maintain backward compatibility with old `matchBare` option\n    if (this.options.matchBare) {\n        Strophe.warn('The \"matchBare\" option is deprecated, use \"matchBareFromJid\" instead.');\n        this.options.matchBareFromJid = this.options.matchBare;\n        delete this.options.matchBare;\n    }\n    if (this.options.matchBareFromJid) {\n        this.from = from ? Strophe.getBareJidFromJid(from) : null;\n    } else {\n        this.from = from;\n    }\n    // whether the handler is a user handler or a system handler\n    this.user = true;\n};\n\nStrophe.Handler.prototype = {\n    /** PrivateFunction: getNamespace\n     *  Returns the XML namespace attribute on an element.\n     *  If `ignoreNamespaceFragment` was passed in for this handler, then the\n     *  URL fragment will be stripped.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The XML element with the namespace.\n     *\n     *  Returns:\n     *    The namespace, with optionally the fragment stripped.\n     */\n    getNamespace: function (elem) {\n        let elNamespace = elem.getAttribute(\"xmlns\");\n        if (elNamespace && this.options.ignoreNamespaceFragment) {\n            elNamespace = elNamespace.split('#')[0];\n        }\n        return elNamespace;\n    },\n\n    /** PrivateFunction: namespaceMatch\n     *  Tests if a stanza matches the namespace set for this Strophe.Handler.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The XML element to test.\n     *\n     *  Returns:\n     *    true if the stanza matches and false otherwise.\n     */\n    namespaceMatch: function (elem) {\n        let nsMatch = false;\n        if (!this.ns) {\n            return true;\n        } else {\n            Strophe.forEachChild(elem, null, (elem) => {\n                if (this.getNamespace(elem) === this.ns) {\n                    nsMatch = true;\n                }\n            });\n            return nsMatch || this.getNamespace(elem) === this.ns;\n        }\n    },\n\n    /** PrivateFunction: isMatch\n     *  Tests if a stanza matches the Strophe.Handler.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The XML element to test.\n     *\n     *  Returns:\n     *    true if the stanza matches and false otherwise.\n     */\n    isMatch: function (elem) {\n        let from = elem.getAttribute('from');\n        if (this.options.matchBareFromJid) {\n            from = Strophe.getBareJidFromJid(from);\n        }\n        const elem_type = elem.getAttribute(\"type\");\n        if (this.namespaceMatch(elem) &&\n            (!this.name || Strophe.isTagEqual(elem, this.name)) &&\n            (!this.type || (Array.isArray(this.type) ? this.type.indexOf(elem_type) !== -1 : elem_type === this.type)) &&\n            (!this.id || elem.getAttribute(\"id\") === this.id) &&\n            (!this.from || from === this.from)) {\n                return true;\n        }\n        return false;\n    },\n\n    /** PrivateFunction: run\n     *  Run the callback on a matching stanza.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The DOM element that triggered the\n     *      Strophe.Handler.\n     *\n     *  Returns:\n     *    A boolean indicating if the handler should remain active.\n     */\n    run: function (elem) {\n        let result = null;\n        try {\n            result = this.handler(elem);\n        } catch (e) {\n            Strophe._handleError(e);\n            throw e;\n        }\n        return result;\n    },\n\n    /** PrivateFunction: toString\n     *  Get a String representation of the Strophe.Handler object.\n     *\n     *  Returns:\n     *    A String.\n     */\n    toString: function () {\n        return \"{Handler: \" + this.handler + \"(\" + this.name + \",\" +\n            this.id + \",\" + this.ns + \")}\";\n    }\n};\n\n/** PrivateClass: Strophe.TimedHandler\n *  _Private_ helper class for managing timed handlers.\n *\n *  A Strophe.TimedHandler encapsulates a user provided callback that\n *  should be called after a certain period of time or at regular\n *  intervals.  The return value of the callback determines whether the\n *  Strophe.TimedHandler will continue to fire.\n *\n *  Users will not use Strophe.TimedHandler objects directly, but instead\n *  they will use Strophe.Connection.addTimedHandler() and\n *  Strophe.Connection.deleteTimedHandler().\n */\n\n/** PrivateConstructor: Strophe.TimedHandler\n *  Create and initialize a new Strophe.TimedHandler object.\n *\n *  Parameters:\n *    (Integer) period - The number of milliseconds to wait before the\n *      handler is called.\n *    (Function) handler - The callback to run when the handler fires.  This\n *      function should take no arguments.\n *\n *  Returns:\n *    A new Strophe.TimedHandler object.\n */\nStrophe.TimedHandler = function (period, handler) {\n    this.period = period;\n    this.handler = handler;\n    this.lastCalled = new Date().getTime();\n    this.user = true;\n};\n\nStrophe.TimedHandler.prototype = {\n    /** PrivateFunction: run\n     *  Run the callback for the Strophe.TimedHandler.\n     *\n     *  Returns:\n     *    true if the Strophe.TimedHandler should be called again, and false\n     *      otherwise.\n     */\n    run: function () {\n        this.lastCalled = new Date().getTime();\n        return this.handler();\n    },\n\n    /** PrivateFunction: reset\n     *  Reset the last called time for the Strophe.TimedHandler.\n     */\n    reset: function () {\n        this.lastCalled = new Date().getTime();\n    },\n\n    /** PrivateFunction: toString\n     *  Get a string representation of the Strophe.TimedHandler object.\n     *\n     *  Returns:\n     *    The string representation.\n     */\n    toString: function () {\n        return \"{TimedHandler: \" + this.handler + \"(\" + this.period +\")}\";\n    }\n};\n\n/** Class: Strophe.Connection\n *  XMPP Connection manager.\n *\n *  This class is the main part of Strophe.  It manages a BOSH or websocket\n *  connection to an XMPP server and dispatches events to the user callbacks\n *  as data arrives. It supports SASL PLAIN, SASL DIGEST-MD5, SASL SCRAM-SHA1\n *  and legacy authentication.\n *\n *  After creating a Strophe.Connection object, the user will typically\n *  call connect() with a user supplied callback to handle connection level\n *  events like authentication failure, disconnection, or connection\n *  complete.\n *\n *  The user will also have several event handlers defined by using\n *  addHandler() and addTimedHandler().  These will allow the user code to\n *  respond to interesting stanzas or do something periodically with the\n *  connection. These handlers will be active once authentication is\n *  finished.\n *\n *  To send data to the connection, use send().\n */\n\n/** Constructor: Strophe.Connection\n *  Create and initialize a Strophe.Connection object.\n *\n *  The transport-protocol for this connection will be chosen automatically\n *  based on the given service parameter. URLs starting with \"ws://\" or\n *  \"wss://\" will use WebSockets, URLs starting with \"http://\", \"https://\"\n *  or without a protocol will use BOSH.\n *\n *  To make Strophe connect to the current host you can leave out the protocol\n *  and host part and just pass the path, e.g.\n *\n *  > let conn = new Strophe.Connection(\"/http-bind/\");\n *\n *  Options common to both Websocket and BOSH:\n *  ------------------------------------------\n *\n *  cookies:\n *\n *  The *cookies* option allows you to pass in cookies to be added to the\n *  document. These cookies will then be included in the BOSH XMLHttpRequest\n *  or in the websocket connection.\n *\n *  The passed in value must be a map of cookie names and string values.\n *\n *  > { \"myCookie\": {\n *  >     \"value\": \"1234\",\n *  >     \"domain\": \".example.org\",\n *  >     \"path\": \"/\",\n *  >     \"expires\": expirationDate\n *  >     }\n *  > }\n *\n *  Note that cookies can't be set in this way for other domains (i.e. cross-domain).\n *  Those cookies need to be set under those domains, for example they can be\n *  set server-side by making a XHR call to that domain to ask it to set any\n *  necessary cookies.\n *\n *  mechanisms:\n *\n *  The *mechanisms* option allows you to specify the SASL mechanisms that this\n *  instance of Strophe.Connection (and therefore your XMPP client) will\n *  support.\n *\n *  The value must be an array of objects with Strophe.SASLMechanism\n *  prototypes.\n *\n *  If nothing is specified, then the following mechanisms (and their\n *  priorities) are registered:\n *\n *      SCRAM-SHA1 - 70\n *      DIGEST-MD5 - 60\n *      PLAIN - 50\n *      OAUTH-BEARER - 40\n *      OAUTH-2 - 30\n *      ANONYMOUS - 20\n *      EXTERNAL - 10\n *\n *  WebSocket options:\n *  ------------------\n *\n *  If you want to connect to the current host with a WebSocket connection you\n *  can tell Strophe to use WebSockets through a \"protocol\" attribute in the\n *  optional options parameter. Valid values are \"ws\" for WebSocket and \"wss\"\n *  for Secure WebSocket.\n *  So to connect to \"wss://CURRENT_HOSTNAME/xmpp-websocket\" you would call\n *\n *  > let conn = new Strophe.Connection(\"/xmpp-websocket/\", {protocol: \"wss\"});\n *\n *  Note that relative URLs _NOT_ starting with a \"/\" will also include the path\n *  of the current site.\n *\n *  Also because downgrading security is not permitted by browsers, when using\n *  relative URLs both BOSH and WebSocket connections will use their secure\n *  variants if the current connection to the site is also secure (https).\n *\n *  BOSH options:\n *  -------------\n *\n *  By adding \"sync\" to the options, you can control if requests will\n *  be made synchronously or not. The default behaviour is asynchronous.\n *  If you want to make requests synchronous, make \"sync\" evaluate to true.\n *  > let conn = new Strophe.Connection(\"/http-bind/\", {sync: true});\n *\n *  You can also toggle this on an already established connection.\n *  > conn.options.sync = true;\n *\n *  The *customHeaders* option can be used to provide custom HTTP headers to be\n *  included in the XMLHttpRequests made.\n *\n *  The *keepalive* option can be used to instruct Strophe to maintain the\n *  current BOSH session across interruptions such as webpage reloads.\n *\n *  It will do this by caching the sessions tokens in sessionStorage, and when\n *  \"restore\" is called it will check whether there are cached tokens with\n *  which it can resume an existing session.\n *\n *  The *withCredentials* option should receive a Boolean value and is used to\n *  indicate wether cookies should be included in ajax requests (by default\n *  they're not).\n *  Set this value to true if you are connecting to a BOSH service\n *  and for some reason need to send cookies to it.\n *  In order for this to work cross-domain, the server must also enable\n *  credentials by setting the Access-Control-Allow-Credentials response header\n *  to \"true\". For most usecases however this setting should be false (which\n *  is the default).\n *  Additionally, when using Access-Control-Allow-Credentials, the\n *  Access-Control-Allow-Origin header can't be set to the wildcard \"*\", but\n *  instead must be restricted to actual domains.\n *\n *  The *contentType* option can be set to change the default Content-Type\n *  of \"text/xml; charset=utf-8\", which can be useful to reduce the amount of\n *  CORS preflight requests that are sent to the server.\n *\n *  Parameters:\n *    (String) service - The BOSH or WebSocket service URL.\n *    (Object) options - A hash of configuration options\n *\n *  Returns:\n *    A new Strophe.Connection object.\n */\nStrophe.Connection = function (service, options) {\n    // The service URL\n    this.service = service;\n    // Configuration options\n    this.options = options || {};\n    const proto = this.options.protocol || \"\";\n\n    // Select protocal based on service or options\n    if (service.indexOf(\"ws:\") === 0 || service.indexOf(\"wss:\") === 0 ||\n            proto.indexOf(\"ws\") === 0) {\n        this._proto = new Strophe.Websocket(this);\n    } else {\n        this._proto = new Strophe.Bosh(this);\n    }\n\n    /* The connected JID. */\n    this.jid = \"\";\n    /* the JIDs domain */\n    this.domain = null;\n    /* stream:features */\n    this.features = null;\n\n    // SASL\n    this._sasl_data = {};\n    this.do_session = false;\n    this.do_bind = false;\n\n    // handler lists\n    this.timedHandlers = [];\n    this.handlers = [];\n    this.removeTimeds = [];\n    this.removeHandlers = [];\n    this.addTimeds = [];\n    this.addHandlers = [];\n    this.protocolErrorHandlers = {\n        'HTTP': {},\n        'websocket': {}\n    };\n\n    this._idleTimeout = null;\n    this._disconnectTimeout = null;\n\n    this.authenticated = false;\n    this.connected = false;\n    this.disconnecting = false;\n    this.do_authentication = true;\n    this.paused = false;\n    this.restored = false;\n\n    this._data = [];\n    this._uniqueId = 0;\n\n    this._sasl_success_handler = null;\n    this._sasl_failure_handler = null;\n    this._sasl_challenge_handler = null;\n\n    // Max retries before disconnecting\n    this.maxRetries = 5;\n\n    // Call onIdle callback every 1/10th of a second\n    this._idleTimeout = setTimeout(() => this._onIdle(), 100);\n\n    utils.addCookies(this.options.cookies);\n    this.registerSASLMechanisms(this.options.mechanisms);\n\n    // initialize plugins\n    for (const k in Strophe._connectionPlugins) {\n        if (Object.prototype.hasOwnProperty.call(Strophe._connectionPlugins, k)) {\n            const F = function () {};\n            F.prototype = Strophe._connectionPlugins[k];\n            this[k] = new F();\n            this[k].init(this);\n        }\n    }\n};\n\nStrophe.Connection.prototype = {\n    /** Function: reset\n     *  Reset the connection.\n     *\n     *  This function should be called after a connection is disconnected\n     *  before that connection is reused.\n     */\n    reset: function () {\n        this._proto._reset();\n\n        // SASL\n        this.do_session = false;\n        this.do_bind = false;\n\n        // handler lists\n        this.timedHandlers = [];\n        this.handlers = [];\n        this.removeTimeds = [];\n        this.removeHandlers = [];\n        this.addTimeds = [];\n        this.addHandlers = [];\n\n        this.authenticated = false;\n        this.connected = false;\n        this.disconnecting = false;\n        this.restored = false;\n\n        this._data = [];\n        this._requests = [];\n        this._uniqueId = 0;\n    },\n\n    /** Function: pause\n     *  Pause the request manager.\n     *\n     *  This will prevent Strophe from sending any more requests to the\n     *  server.  This is very useful for temporarily pausing\n     *  BOSH-Connections while a lot of send() calls are happening quickly.\n     *  This causes Strophe to send the data in a single request, saving\n     *  many request trips.\n     */\n    pause: function () {\n        this.paused = true;\n    },\n\n    /** Function: resume\n     *  Resume the request manager.\n     *\n     *  This resumes after pause() has been called.\n     */\n    resume: function () {\n        this.paused = false;\n    },\n\n    /** Function: getUniqueId\n     *  Generate a unique ID for use in <iq/> elements.\n     *\n     *  All <iq/> stanzas are required to have unique id attributes.  This\n     *  function makes creating these easy.  Each connection instance has\n     *  a counter which starts from zero, and the value of this counter\n     *  plus a colon followed by the suffix becomes the unique id. If no\n     *  suffix is supplied, the counter is used as the unique id.\n     *\n     *  Suffixes are used to make debugging easier when reading the stream\n     *  data, and their use is recommended.  The counter resets to 0 for\n     *  every new connection for the same reason.  For connections to the\n     *  same server that authenticate the same way, all the ids should be\n     *  the same, which makes it easy to see changes.  This is useful for\n     *  automated testing as well.\n     *\n     *  Parameters:\n     *    (String) suffix - A optional suffix to append to the id.\n     *\n     *  Returns:\n     *    A unique string to be used for the id attribute.\n     */\n    getUniqueId: function (suffix) {\n        const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n            const r = Math.random() * 16 | 0,\n                  v = c === 'x' ? r : r & 0x3 | 0x8;\n            return v.toString(16);\n        });\n        if (typeof(suffix) === \"string\" || typeof(suffix) === \"number\") {\n            return uuid + \":\" + suffix;\n        } else {\n            return uuid + \"\";\n        }\n    },\n\n    /** Function: addProtocolErrorHandler\n     *  Register a handler function for when a protocol (websocker or HTTP)\n     *  error occurs.\n     *\n     *  NOTE: Currently only HTTP errors for BOSH requests are handled.\n     *  Patches that handle websocket errors would be very welcome.\n     *\n     *  Parameters:\n     *    (String) protocol - 'HTTP' or 'websocket'\n     *    (Integer) status_code - Error status code (e.g 500, 400 or 404)\n     *    (Function) callback - Function that will fire on Http error\n     *\n     *  Example:\n     *  function onError(err_code){\n     *    //do stuff\n     *  }\n     *\n     *  let conn = Strophe.connect('http://example.com/http-bind');\n     *  conn.addProtocolErrorHandler('HTTP', 500, onError);\n     *  // Triggers HTTP 500 error and onError handler will be called\n     *  conn.connect('user_jid@incorrect_jabber_host', 'secret', onConnect);\n     */\n    addProtocolErrorHandler: function (protocol, status_code, callback){\n        this.protocolErrorHandlers[protocol][status_code] = callback;\n    },\n\n\n    /** Function: connect\n     *  Starts the connection process.\n     *\n     *  As the connection process proceeds, the user supplied callback will\n     *  be triggered multiple times with status updates.  The callback\n     *  should take two arguments - the status code and the error condition.\n     *\n     *  The status code will be one of the values in the Strophe.Status\n     *  constants.  The error condition will be one of the conditions\n     *  defined in RFC 3920 or the condition 'strophe-parsererror'.\n     *\n     *  The Parameters _wait_, _hold_ and _route_ are optional and only relevant\n     *  for BOSH connections. Please see XEP 124 for a more detailed explanation\n     *  of the optional parameters.\n     *\n     *  Parameters:\n     *    (String) jid - The user's JID.  This may be a bare JID,\n     *      or a full JID.  If a node is not supplied, SASL OAUTHBEARER or\n     *      SASL ANONYMOUS authentication will be attempted (OAUTHBEARER will\n     *      process the provided password value as an access token).\n     *    (String) pass - The user's password.\n     *    (Function) callback - The connect callback function.\n     *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n     *      time the server will wait before returning an empty result for\n     *      a request.  The default setting of 60 seconds is recommended.\n     *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n     *      number of connections the server will hold at one time.  This\n     *      should almost always be set to 1 (the default).\n     *    (String) route - The optional route value.\n     *    (String) authcid - The optional alternative authentication identity\n     *      (username) if intending to impersonate another user.\n     *      When using the SASL-EXTERNAL authentication mechanism, for example\n     *      with client certificates, then the authcid value is used to\n     *      determine whether an authorization JID (authzid) should be sent to\n     *      the server. The authzid should not be sent to the server if the\n     *      authzid and authcid are the same. So to prevent it from being sent\n     *      (for example when the JID is already contained in the client\n     *      certificate), set authcid to that same JID. See XEP-178 for more\n     *      details.\n     */\n    connect: function (jid, pass, callback, wait, hold, route, authcid) {\n        this.jid = jid;\n        /** Variable: authzid\n         *  Authorization identity.\n         */\n        this.authzid = Strophe.getBareJidFromJid(this.jid);\n\n        /** Variable: authcid\n         *  Authentication identity (User name).\n         */\n        this.authcid = authcid || Strophe.getNodeFromJid(this.jid);\n\n        /** Variable: pass\n         *  Authentication identity (User password).\n         */\n        this.pass = pass;\n\n        /** Variable: servtype\n         *  Digest MD5 compatibility.\n         */\n        this.servtype = \"xmpp\";\n\n        this.connect_callback = callback;\n        this.disconnecting = false;\n        this.connected = false;\n        this.authenticated = false;\n        this.restored = false;\n\n        // parse jid for domain\n        this.domain = Strophe.getDomainFromJid(this.jid);\n\n        this._changeConnectStatus(Strophe.Status.CONNECTING, null);\n\n        this._proto._connect(wait, hold, route);\n    },\n\n    /** Function: attach\n     *  Attach to an already created and authenticated BOSH session.\n     *\n     *  This function is provided to allow Strophe to attach to BOSH\n     *  sessions which have been created externally, perhaps by a Web\n     *  application.  This is often used to support auto-login type features\n     *  without putting user credentials into the page.\n     *\n     *  Parameters:\n     *    (String) jid - The full JID that is bound by the session.\n     *    (String) sid - The SID of the BOSH session.\n     *    (String) rid - The current RID of the BOSH session.  This RID\n     *      will be used by the next request.\n     *    (Function) callback The connect callback function.\n     *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n     *      time the server will wait before returning an empty result for\n     *      a request.  The default setting of 60 seconds is recommended.\n     *      Other settings will require tweaks to the Strophe.TIMEOUT value.\n     *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n     *      number of connections the server will hold at one time.  This\n     *      should almost always be set to 1 (the default).\n     *    (Integer) wind - The optional HTTBIND window value.  This is the\n     *      allowed range of request ids that are valid.  The default is 5.\n     */\n    attach: function (jid, sid, rid, callback, wait, hold, wind) {\n        if (this._proto instanceof Strophe.Bosh) {\n            this._proto._attach(jid, sid, rid, callback, wait, hold, wind);\n        } else {\n            const error = new Error('The \"attach\" method can only be used with a BOSH connection.');\n            error.name = 'StropheSessionError';\n            throw error;\n        }\n    },\n\n    /** Function: restore\n     *  Attempt to restore a cached BOSH session.\n     *\n     *  This function is only useful in conjunction with providing the\n     *  \"keepalive\":true option when instantiating a new Strophe.Connection.\n     *\n     *  When \"keepalive\" is set to true, Strophe will cache the BOSH tokens\n     *  RID (Request ID) and SID (Session ID) and then when this function is\n     *  called, it will attempt to restore the session from those cached\n     *  tokens.\n     *\n     *  This function must therefore be called instead of connect or attach.\n     *\n     *  For an example on how to use it, please see examples/restore.js\n     *\n     *  Parameters:\n     *    (String) jid - The user's JID.  This may be a bare JID or a full JID.\n     *    (Function) callback - The connect callback function.\n     *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n     *      time the server will wait before returning an empty result for\n     *      a request.  The default setting of 60 seconds is recommended.\n     *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n     *      number of connections the server will hold at one time.  This\n     *      should almost always be set to 1 (the default).\n     *    (Integer) wind - The optional HTTBIND window value.  This is the\n     *      allowed range of request ids that are valid.  The default is 5.\n     */\n    restore: function (jid, callback, wait, hold, wind) {\n        if (this._sessionCachingSupported()) {\n            this._proto._restore(jid, callback, wait, hold, wind);\n        } else {\n            const error = new Error('The \"attach\" method can only be used with a BOSH connection.');\n            error.name = 'StropheSessionError';\n            throw error;\n        }\n    },\n\n    /** PrivateFunction: _sessionCachingSupported\n     * Checks whether sessionStorage and JSON are supported and whether we're\n     * using BOSH.\n     */\n    _sessionCachingSupported: function () {\n        if (this._proto instanceof Strophe.Bosh) {\n            if (!JSON) { return false; }\n            try {\n                sessionStorage.setItem('_strophe_', '_strophe_');\n                sessionStorage.removeItem('_strophe_');\n            } catch (e) {\n                return false;\n            }\n            return true;\n        }\n        return false;\n    },\n\n    /** Function: xmlInput\n     *  User overrideable function that receives XML data coming into the\n     *  connection.\n     *\n     *  The default function does nothing.  User code can override this with\n     *  > Strophe.Connection.xmlInput = function (elem) {\n     *  >   (user code)\n     *  > };\n     *\n     *  Due to limitations of current Browsers' XML-Parsers the opening and closing\n     *  <stream> tag for WebSocket-Connoctions will be passed as selfclosing here.\n     *\n     *  BOSH-Connections will have all stanzas wrapped in a <body> tag. See\n     *  <Strophe.Bosh.strip> if you want to strip this tag.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The XML data received by the connection.\n     */\n    /* jshint unused:false */\n    xmlInput: function (elem) {\n        return;\n    },\n    /* jshint unused:true */\n\n    /** Function: xmlOutput\n     *  User overrideable function that receives XML data sent to the\n     *  connection.\n     *\n     *  The default function does nothing.  User code can override this with\n     *  > Strophe.Connection.xmlOutput = function (elem) {\n     *  >   (user code)\n     *  > };\n     *\n     *  Due to limitations of current Browsers' XML-Parsers the opening and closing\n     *  <stream> tag for WebSocket-Connoctions will be passed as selfclosing here.\n     *\n     *  BOSH-Connections will have all stanzas wrapped in a <body> tag. See\n     *  <Strophe.Bosh.strip> if you want to strip this tag.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The XMLdata sent by the connection.\n     */\n    /* jshint unused:false */\n    xmlOutput: function (elem) {\n        return;\n    },\n    /* jshint unused:true */\n\n    /** Function: rawInput\n     *  User overrideable function that receives raw data coming into the\n     *  connection.\n     *\n     *  The default function does nothing.  User code can override this with\n     *  > Strophe.Connection.rawInput = function (data) {\n     *  >   (user code)\n     *  > };\n     *\n     *  Parameters:\n     *    (String) data - The data received by the connection.\n     */\n    /* jshint unused:false */\n    rawInput: function (data) {\n        return;\n    },\n    /* jshint unused:true */\n\n    /** Function: rawOutput\n     *  User overrideable function that receives raw data sent to the\n     *  connection.\n     *\n     *  The default function does nothing.  User code can override this with\n     *  > Strophe.Connection.rawOutput = function (data) {\n     *  >   (user code)\n     *  > };\n     *\n     *  Parameters:\n     *    (String) data - The data sent by the connection.\n     */\n    /* jshint unused:false */\n    rawOutput: function (data) {\n        return;\n    },\n    /* jshint unused:true */\n\n    /** Function: nextValidRid\n     *  User overrideable function that receives the new valid rid.\n     *\n     *  The default function does nothing. User code can override this with\n     *  > Strophe.Connection.nextValidRid = function (rid) {\n     *  >    (user code)\n     *  > };\n     *\n     *  Parameters:\n     *    (Number) rid - The next valid rid\n     */\n    /* jshint unused:false */\n    nextValidRid: function (rid) {\n        return;\n    },\n    /* jshint unused:true */\n\n    /** Function: send\n     *  Send a stanza.\n     *\n     *  This function is called to push data onto the send queue to\n     *  go out over the wire.  Whenever a request is sent to the BOSH\n     *  server, all pending data is sent and the queue is flushed.\n     *\n     *  Parameters:\n     *    (XMLElement |\n     *     [XMLElement] |\n     *     Strophe.Builder) elem - The stanza to send.\n     */\n    send: function (elem) {\n        if (elem === null) { return ; }\n        if (typeof(elem.sort) === \"function\") {\n            for (let i=0; i < elem.length; i++) {\n                this._queueData(elem[i]);\n            }\n        } else if (typeof(elem.tree) === \"function\") {\n            this._queueData(elem.tree());\n        } else {\n            this._queueData(elem);\n        }\n        this._proto._send();\n    },\n\n    /** Function: flush\n     *  Immediately send any pending outgoing data.\n     *\n     *  Normally send() queues outgoing data until the next idle period\n     *  (100ms), which optimizes network use in the common cases when\n     *  several send()s are called in succession. flush() can be used to\n     *  immediately send all pending data.\n     */\n    flush: function () {\n        // cancel the pending idle period and run the idle function\n        // immediately\n        clearTimeout(this._idleTimeout);\n        this._onIdle();\n    },\n\n    /** Function: sendPresence\n     *  Helper function to send presence stanzas. The main benefit is for\n     *  sending presence stanzas for which you expect a responding presence\n     *  stanza with the same id (for example when leaving a chat room).\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The stanza to send.\n     *    (Function) callback - The callback function for a successful request.\n     *    (Function) errback - The callback function for a failed or timed\n     *      out request.  On timeout, the stanza will be null.\n     *    (Integer) timeout - The time specified in milliseconds for a\n     *      timeout to occur.\n     *\n     *  Returns:\n     *    The id used to send the presence.\n     */\n    sendPresence: function(elem, callback, errback, timeout) {\n        let timeoutHandler = null;\n        if (typeof(elem.tree) === \"function\") {\n            elem = elem.tree();\n        }\n        let id = elem.getAttribute('id');\n        if (!id) { // inject id if not found\n            id = this.getUniqueId(\"sendPresence\");\n            elem.setAttribute(\"id\", id);\n        }\n\n        if (typeof callback === \"function\" || typeof errback === \"function\") {\n            const handler = this.addHandler(stanza => {\n                // remove timeout handler if there is one\n                if (timeoutHandler) {\n                    this.deleteTimedHandler(timeoutHandler);\n                }\n                if (stanza.getAttribute('type') === 'error') {\n                    if (errback) {\n                        errback(stanza);\n                    }\n                } else if (callback) {\n                    callback(stanza);\n                }\n            }, null, 'presence', null, id);\n\n            // if timeout specified, set up a timeout handler.\n            if (timeout) {\n                timeoutHandler = this.addTimedHandler(timeout, () => {\n                    // get rid of normal handler\n                    this.deleteHandler(handler);\n                    // call errback on timeout with null stanza\n                    if (errback) {\n                        errback(null);\n                    }\n                    return false;\n                });\n            }\n        }\n        this.send(elem);\n        return id;\n    },\n\n    /** Function: sendIQ\n     *  Helper function to send IQ stanzas.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The stanza to send.\n     *    (Function) callback - The callback function for a successful request.\n     *    (Function) errback - The callback function for a failed or timed\n     *      out request.  On timeout, the stanza will be null.\n     *    (Integer) timeout - The time specified in milliseconds for a\n     *      timeout to occur.\n     *\n     *  Returns:\n     *    The id used to send the IQ.\n    */\n    sendIQ: function(elem, callback, errback, timeout) {\n        let timeoutHandler = null;\n        if (typeof(elem.tree) === \"function\") {\n            elem = elem.tree();\n        }\n        let id = elem.getAttribute('id');\n        if (!id) { // inject id if not found\n            id = this.getUniqueId(\"sendIQ\");\n            elem.setAttribute(\"id\", id);\n        }\n\n        if (typeof callback === \"function\" || typeof errback === \"function\") {\n            const handler = this.addHandler(stanza => {\n                // remove timeout handler if there is one\n                if (timeoutHandler) {\n                    this.deleteTimedHandler(timeoutHandler);\n                }\n                const iqtype = stanza.getAttribute('type');\n                if (iqtype === 'result') {\n                    if (callback) {\n                        callback(stanza);\n                    }\n                } else if (iqtype === 'error') {\n                    if (errback) {\n                        errback(stanza);\n                    }\n                } else {\n                    const error = new Error(`Got bad IQ type of ${iqtype}`);\n                    error.name = \"StropheError\";\n                }\n            }, null, 'iq', ['error', 'result'], id);\n\n            // if timeout specified, set up a timeout handler.\n            if (timeout) {\n                timeoutHandler = this.addTimedHandler(timeout, () => {\n                    // get rid of normal handler\n                    this.deleteHandler(handler);\n                    // call errback on timeout with null stanza\n                    if (errback) {\n                        errback(null);\n                    }\n                    return false;\n                });\n            }\n        }\n        this.send(elem);\n        return id;\n    },\n\n    /** PrivateFunction: _queueData\n     *  Queue outgoing data for later sending.  Also ensures that the data\n     *  is a DOMElement.\n     */\n    _queueData: function (element) {\n        if (element === null ||\n                !element.tagName ||\n                !element.childNodes) {\n            const error = new Error(\"Cannot queue non-DOMElement.\");\n            error.name = \"StropheError\";\n        }\n        this._data.push(element);\n    },\n\n    /** PrivateFunction: _sendRestart\n     *  Send an xmpp:restart stanza.\n     */\n    _sendRestart: function () {\n        this._data.push(\"restart\");\n        this._proto._sendRestart();\n        this._idleTimeout = setTimeout(() => this._onIdle(), 100);\n    },\n\n    /** Function: addTimedHandler\n     *  Add a timed handler to the connection.\n     *\n     *  This function adds a timed handler.  The provided handler will\n     *  be called every period milliseconds until it returns false,\n     *  the connection is terminated, or the handler is removed.  Handlers\n     *  that wish to continue being invoked should return true.\n     *\n     *  Because of method binding it is necessary to save the result of\n     *  this function if you wish to remove a handler with\n     *  deleteTimedHandler().\n     *\n     *  Note that user handlers are not active until authentication is\n     *  successful.\n     *\n     *  Parameters:\n     *    (Integer) period - The period of the handler.\n     *    (Function) handler - The callback function.\n     *\n     *  Returns:\n     *    A reference to the handler that can be used to remove it.\n     */\n    addTimedHandler: function (period, handler) {\n        const thand = new Strophe.TimedHandler(period, handler);\n        this.addTimeds.push(thand);\n        return thand;\n    },\n\n    /** Function: deleteTimedHandler\n     *  Delete a timed handler for a connection.\n     *\n     *  This function removes a timed handler from the connection.  The\n     *  handRef parameter is *not* the function passed to addTimedHandler(),\n     *  but is the reference returned from addTimedHandler().\n     *\n     *  Parameters:\n     *    (Strophe.TimedHandler) handRef - The handler reference.\n     */\n    deleteTimedHandler: function (handRef) {\n        // this must be done in the Idle loop so that we don't change\n        // the handlers during iteration\n        this.removeTimeds.push(handRef);\n    },\n\n    /** Function: addHandler\n     *  Add a stanza handler for the connection.\n     *\n     *  This function adds a stanza handler to the connection.  The\n     *  handler callback will be called for any stanza that matches\n     *  the parameters.  Note that if multiple parameters are supplied,\n     *  they must all match for the handler to be invoked.\n     *\n     *  The handler will receive the stanza that triggered it as its argument.\n     *  *The handler should return true if it is to be invoked again;\n     *  returning false will remove the handler after it returns.*\n     *\n     *  As a convenience, the ns parameters applies to the top level element\n     *  and also any of its immediate children.  This is primarily to make\n     *  matching /iq/query elements easy.\n     *\n     *  Options\n     *  ~~~~~~~\n     *  With the options argument, you can specify boolean flags that affect how\n     *  matches are being done.\n     *\n     *  Currently two flags exist:\n     *\n     *  - matchBareFromJid:\n     *      When set to true, the from parameter and the\n     *      from attribute on the stanza will be matched as bare JIDs instead\n     *      of full JIDs. To use this, pass {matchBareFromJid: true} as the\n     *      value of options. The default value for matchBareFromJid is false.\n     *\n     *  - ignoreNamespaceFragment:\n     *      When set to true, a fragment specified on the stanza's namespace\n     *      URL will be ignored when it's matched with the one configured for\n     *      the handler.\n     *\n     *      This means that if you register like this:\n     *      >   connection.addHandler(\n     *      >       handler,\n     *      >       'http://jabber.org/protocol/muc',\n     *      >       null, null, null, null,\n     *      >       {'ignoreNamespaceFragment': true}\n     *      >   );\n     *\n     *      Then a stanza with XML namespace of\n     *      'http://jabber.org/protocol/muc#user' will also be matched. If\n     *      'ignoreNamespaceFragment' is false, then only stanzas with\n     *      'http://jabber.org/protocol/muc' will be matched.\n     *\n     *  Deleting the handler\n     *  ~~~~~~~~~~~~~~~~~~~~\n     *  The return value should be saved if you wish to remove the handler\n     *  with deleteHandler().\n     *\n     *  Parameters:\n     *    (Function) handler - The user callback.\n     *    (String) ns - The namespace to match.\n     *    (String) name - The stanza name to match.\n     *    (String|Array) type - The stanza type (or types if an array) to match.\n     *    (String) id - The stanza id attribute to match.\n     *    (String) from - The stanza from attribute to match.\n     *    (String) options - The handler options\n     *\n     *  Returns:\n     *    A reference to the handler that can be used to remove it.\n     */\n    addHandler: function (handler, ns, name, type, id, from, options) {\n        const hand = new Strophe.Handler(handler, ns, name, type, id, from, options);\n        this.addHandlers.push(hand);\n        return hand;\n    },\n\n    /** Function: deleteHandler\n     *  Delete a stanza handler for a connection.\n     *\n     *  This function removes a stanza handler from the connection.  The\n     *  handRef parameter is *not* the function passed to addHandler(),\n     *  but is the reference returned from addHandler().\n     *\n     *  Parameters:\n     *    (Strophe.Handler) handRef - The handler reference.\n     */\n    deleteHandler: function (handRef) {\n        // this must be done in the Idle loop so that we don't change\n        // the handlers during iteration\n        this.removeHandlers.push(handRef);\n        // If a handler is being deleted while it is being added,\n        // prevent it from getting added\n        const i = this.addHandlers.indexOf(handRef);\n        if (i >= 0) {\n            this.addHandlers.splice(i, 1);\n        }\n    },\n\n    /** Function: registerSASLMechanisms\n     *\n     * Register the SASL mechanisms which will be supported by this instance of\n     * Strophe.Connection (i.e. which this XMPP client will support).\n     *\n     *  Parameters:\n     *    (Array) mechanisms - Array of objects with Strophe.SASLMechanism prototypes\n     *\n     */\n    registerSASLMechanisms: function (mechanisms) {\n        this.mechanisms = {};\n        mechanisms = mechanisms || [\n            Strophe.SASLAnonymous,\n            Strophe.SASLExternal,\n            Strophe.SASLMD5,\n            Strophe.SASLOAuthBearer,\n            Strophe.SASLXOAuth2,\n            Strophe.SASLPlain,\n            Strophe.SASLSHA1\n        ];\n        mechanisms.forEach(this.registerSASLMechanism.bind(this));\n    },\n\n    /** Function: registerSASLMechanism\n     *\n     * Register a single SASL mechanism, to be supported by this client.\n     *\n     *  Parameters:\n     *    (Object) mechanism - Object with a Strophe.SASLMechanism prototype\n     *\n     */\n    registerSASLMechanism: function (mechanism) {\n        this.mechanisms[mechanism.prototype.name] = mechanism;\n    },\n\n    /** Function: disconnect\n     *  Start the graceful disconnection process.\n     *\n     *  This function starts the disconnection process.  This process starts\n     *  by sending unavailable presence and sending BOSH body of type\n     *  terminate.  A timeout handler makes sure that disconnection happens\n     *  even if the BOSH server does not respond.\n     *  If the Connection object isn't connected, at least tries to abort all pending requests\n     *  so the connection object won't generate successful requests (which were already opened).\n     *\n     *  The user supplied connection callback will be notified of the\n     *  progress as this process happens.\n     *\n     *  Parameters:\n     *    (String) reason - The reason the disconnect is occuring.\n     */\n    disconnect: function (reason) {\n        this._changeConnectStatus(Strophe.Status.DISCONNECTING, reason);\n        Strophe.info(\"Disconnect was called because: \" + reason);\n        if (this.connected) {\n            let pres = false;\n            this.disconnecting = true;\n            if (this.authenticated) {\n                pres = $pres({\n                    'xmlns': Strophe.NS.CLIENT,\n                    'type': 'unavailable'\n                });\n            }\n            // setup timeout handler\n            this._disconnectTimeout = this._addSysTimedHandler(\n                3000, this._onDisconnectTimeout.bind(this));\n            this._proto._disconnect(pres);\n        } else {\n            Strophe.info(\"Disconnect was called before Strophe connected to the server\");\n            this._proto._abortAllRequests();\n            this._doDisconnect();\n        }\n    },\n\n    /** PrivateFunction: _changeConnectStatus\n     *  _Private_ helper function that makes sure plugins and the user's\n     *  callback are notified of connection status changes.\n     *\n     *  Parameters:\n     *    (Integer) status - the new connection status, one of the values\n     *      in Strophe.Status\n     *    (String) condition - the error condition or null\n     *    (XMLElement) elem - The triggering stanza.\n     */\n    _changeConnectStatus: function (status, condition, elem) {\n        // notify all plugins listening for status changes\n        for (const k in Strophe._connectionPlugins) {\n            if (Object.prototype.hasOwnProperty.call(Strophe._connectionPlugins, k)) {\n                const plugin = this[k];\n                if (plugin.statusChanged) {\n                    try {\n                        plugin.statusChanged(status, condition);\n                    } catch (err) {\n                        Strophe.error(`${k} plugin caused an exception changing status: ${err}`);\n                    }\n                }\n            }\n        }\n        // notify the user's callback\n        if (this.connect_callback) {\n            try {\n                this.connect_callback(status, condition, elem);\n            } catch (e) {\n                Strophe._handleError(e);\n                Strophe.error(`User connection callback caused an exception: ${e}`);\n            }\n        }\n    },\n\n    /** PrivateFunction: _doDisconnect\n     *  _Private_ function to disconnect.\n     *\n     *  This is the last piece of the disconnection logic.  This resets the\n     *  connection and alerts the user's connection callback.\n     */\n    _doDisconnect: function (condition) {\n        if (typeof this._idleTimeout === \"number\") {\n            clearTimeout(this._idleTimeout);\n        }\n\n        // Cancel Disconnect Timeout\n        if (this._disconnectTimeout !== null) {\n            this.deleteTimedHandler(this._disconnectTimeout);\n            this._disconnectTimeout = null;\n        }\n\n        Strophe.info(\"_doDisconnect was called\");\n        this._proto._doDisconnect();\n\n        this.authenticated = false;\n        this.disconnecting = false;\n        this.restored = false;\n\n        // delete handlers\n        this.handlers = [];\n        this.timedHandlers = [];\n        this.removeTimeds = [];\n        this.removeHandlers = [];\n        this.addTimeds = [];\n        this.addHandlers = [];\n\n        // tell the parent we disconnected\n        this._changeConnectStatus(Strophe.Status.DISCONNECTED, condition);\n        this.connected = false;\n    },\n\n    /** PrivateFunction: _dataRecv\n     *  _Private_ handler to processes incoming data from the the connection.\n     *\n     *  Except for _connect_cb handling the initial connection request,\n     *  this function handles the incoming data for all requests.  This\n     *  function also fires stanza handlers that match each incoming\n     *  stanza.\n     *\n     *  Parameters:\n     *    (Strophe.Request) req - The request that has data ready.\n     *    (string) req - The stanza a raw string (optiona).\n     */\n    _dataRecv: function (req, raw) {\n        Strophe.info(\"_dataRecv called\");\n        const elem = this._proto._reqToData(req);\n        if (elem === null) { return; }\n\n        if (this.xmlInput !== Strophe.Connection.prototype.xmlInput) {\n            if (elem.nodeName === this._proto.strip && elem.childNodes.length) {\n                this.xmlInput(elem.childNodes[0]);\n            } else {\n                this.xmlInput(elem);\n            }\n        }\n        if (this.rawInput !== Strophe.Connection.prototype.rawInput) {\n            if (raw) {\n                this.rawInput(raw);\n            } else {\n                this.rawInput(Strophe.serialize(elem));\n            }\n        }\n\n        // remove handlers scheduled for deletion\n        while (this.removeHandlers.length > 0) {\n            const hand = this.removeHandlers.pop();\n            const i = this.handlers.indexOf(hand);\n            if (i >= 0) {\n                this.handlers.splice(i, 1);\n            }\n        }\n\n        // add handlers scheduled for addition\n        while (this.addHandlers.length > 0) {\n            this.handlers.push(this.addHandlers.pop());\n        }\n\n        // handle graceful disconnect\n        if (this.disconnecting && this._proto._emptyQueue()) {\n            this._doDisconnect();\n            return;\n        }\n\n        const type = elem.getAttribute(\"type\");\n        if (type !== null && type === \"terminate\") {\n            // Don't process stanzas that come in after disconnect\n            if (this.disconnecting) {\n                return;\n            }\n            // an error occurred\n            let cond = elem.getAttribute(\"condition\");\n            const conflict = elem.getElementsByTagName(\"conflict\");\n            if (cond !== null) {\n                if (cond === \"remote-stream-error\" && conflict.length > 0) {\n                    cond = \"conflict\";\n                }\n                this._changeConnectStatus(Strophe.Status.CONNFAIL, cond);\n            } else {\n                this._changeConnectStatus(\n                    Strophe.Status.CONNFAIL,\n                    Strophe.ErrorCondition.UNKOWN_REASON\n                );\n            }\n            this._doDisconnect(cond);\n            return;\n        }\n\n        // send each incoming stanza through the handler chain\n        Strophe.forEachChild(elem, null, child => {\n            // process handlers\n            const newList = this.handlers;\n            this.handlers = [];\n            for (let i=0; i < newList.length; i++) {\n                const hand = newList[i];\n                // encapsulate 'handler.run' not to lose the whole handler list if\n                // one of the handlers throws an exception\n                try {\n                    if (hand.isMatch(child) &&\n                        (this.authenticated || !hand.user)) {\n                        if (hand.run(child)) {\n                            this.handlers.push(hand);\n                        }\n                    } else {\n                        this.handlers.push(hand);\n                    }\n                } catch(e) {\n                    // if the handler throws an exception, we consider it as false\n                    Strophe.warn('Removing Strophe handlers due to uncaught exception: '+e.message);\n                }\n            }\n        });\n    },\n\n\n    /** Attribute: mechanisms\n     *  SASL Mechanisms available for Connection.\n     */\n    mechanisms: {},\n\n    /** PrivateFunction: _connect_cb\n     *  _Private_ handler for initial connection request.\n     *\n     *  This handler is used to process the initial connection request\n     *  response from the BOSH server. It is used to set up authentication\n     *  handlers and start the authentication process.\n     *\n     *  SASL authentication will be attempted if available, otherwise\n     *  the code will fall back to legacy authentication.\n     *\n     *  Parameters:\n     *    (Strophe.Request) req - The current request.\n     *    (Function) _callback - low level (xmpp) connect callback function.\n     *      Useful for plugins with their own xmpp connect callback (when they\n     *      want to do something special).\n     */\n    _connect_cb: function (req, _callback, raw) {\n        Strophe.info(\"_connect_cb was called\");\n        this.connected = true;\n\n        let bodyWrap;\n        try {\n            bodyWrap = this._proto._reqToData(req);\n        } catch (e) {\n            if (e !== \"badformat\") { throw e; }\n            this._changeConnectStatus(\n                Strophe.Status.CONNFAIL,\n                Strophe.ErrorCondition.BAD_FORMAT\n            );\n            this._doDisconnect(Strophe.ErrorCondition.BAD_FORMAT);\n        }\n        if (!bodyWrap) { return; }\n\n        if (this.xmlInput !== Strophe.Connection.prototype.xmlInput) {\n            if (bodyWrap.nodeName === this._proto.strip && bodyWrap.childNodes.length) {\n                this.xmlInput(bodyWrap.childNodes[0]);\n            } else {\n                this.xmlInput(bodyWrap);\n            }\n        }\n        if (this.rawInput !== Strophe.Connection.prototype.rawInput) {\n            if (raw) {\n                this.rawInput(raw);\n            } else {\n                this.rawInput(Strophe.serialize(bodyWrap));\n            }\n        }\n\n        const conncheck = this._proto._connect_cb(bodyWrap);\n        if (conncheck === Strophe.Status.CONNFAIL) {\n            return;\n        }\n\n        // Check for the stream:features tag\n        let hasFeatures;\n        if (bodyWrap.getElementsByTagNameNS) {\n            hasFeatures = bodyWrap.getElementsByTagNameNS(Strophe.NS.STREAM, \"features\").length > 0;\n        } else {\n            hasFeatures = bodyWrap.getElementsByTagName(\"stream:features\").length > 0 ||\n                            bodyWrap.getElementsByTagName(\"features\").length > 0;\n        }\n        if (!hasFeatures) {\n            this._proto._no_auth_received(_callback);\n            return;\n        }\n\n        const matched = [];\n        const mechanisms = bodyWrap.getElementsByTagName(\"mechanism\");\n        if (mechanisms.length > 0) {\n            for (let i=0; i < mechanisms.length; i++) {\n                const mech = Strophe.getText(mechanisms[i]);\n                if (this.mechanisms[mech]) matched.push(this.mechanisms[mech]);\n            }\n        }\n        if (matched.length === 0) {\n            if (bodyWrap.getElementsByTagName(\"auth\").length === 0) {\n                // There are no matching SASL mechanisms and also no legacy\n                // auth available.\n                this._proto._no_auth_received(_callback);\n                return;\n            }\n        }\n        if (this.do_authentication !== false) {\n            this.authenticate(matched);\n        }\n    },\n\n    /** Function: sortMechanismsByPriority\n     *\n     *  Sorts an array of objects with prototype SASLMechanism according to\n     *  their priorities.\n     *\n     *  Parameters:\n     *    (Array) mechanisms - Array of SASL mechanisms.\n     *\n     */\n    sortMechanismsByPriority: function (mechanisms) {\n        // Sorting mechanisms according to priority.\n        for (let i=0; i < mechanisms.length - 1; ++i) {\n            let higher = i;\n            for (let j=i + 1; j < mechanisms.length; ++j) {\n                if (mechanisms[j].prototype.priority > mechanisms[higher].prototype.priority) {\n                    higher = j;\n                }\n            }\n            if (higher !== i) {\n                const swap = mechanisms[i];\n                mechanisms[i] = mechanisms[higher];\n                mechanisms[higher] = swap;\n            }\n        }\n        return mechanisms;\n    },\n\n    /** PrivateFunction: _attemptSASLAuth\n     *\n     *  Iterate through an array of SASL mechanisms and attempt authentication\n     *  with the highest priority (enabled) mechanism.\n     *\n     *  Parameters:\n     *    (Array) mechanisms - Array of SASL mechanisms.\n     *\n     *  Returns:\n     *    (Boolean) mechanism_found - true or false, depending on whether a\n     *          valid SASL mechanism was found with which authentication could be\n     *          started.\n     */\n    _attemptSASLAuth: function (mechanisms) {\n        mechanisms = this.sortMechanismsByPriority(mechanisms || []);\n        let mechanism_found = false;\n        for (let i=0; i < mechanisms.length; ++i) {\n            if (!mechanisms[i].prototype.test(this)) {\n                continue;\n            }\n            this._sasl_success_handler = this._addSysHandler(\n                this._sasl_success_cb.bind(this), null,\n                \"success\", null, null);\n            this._sasl_failure_handler = this._addSysHandler(\n                this._sasl_failure_cb.bind(this), null,\n                \"failure\", null, null);\n            this._sasl_challenge_handler = this._addSysHandler(\n                this._sasl_challenge_cb.bind(this), null,\n                \"challenge\", null, null);\n\n            this._sasl_mechanism = new mechanisms[i]();\n            this._sasl_mechanism.onStart(this);\n\n            const request_auth_exchange = $build(\"auth\", {\n                'xmlns': Strophe.NS.SASL,\n                'mechanism': this._sasl_mechanism.name\n            });\n            if (this._sasl_mechanism.isClientFirst) {\n                const response = this._sasl_mechanism.onChallenge(this, null);\n                request_auth_exchange.t(btoa(response));\n            }\n            this.send(request_auth_exchange.tree());\n            mechanism_found = true;\n            break;\n        }\n        return mechanism_found;\n    },\n\n    /** PrivateFunction: _attemptLegacyAuth\n     *\n     *  Attempt legacy (i.e. non-SASL) authentication.\n     *\n     */\n    _attemptLegacyAuth: function () {\n        if (Strophe.getNodeFromJid(this.jid) === null) {\n            // we don't have a node, which is required for non-anonymous\n            // client connections\n            this._changeConnectStatus(\n                Strophe.Status.CONNFAIL,\n                Strophe.ErrorCondition.MISSING_JID_NODE\n            );\n            this.disconnect(Strophe.ErrorCondition.MISSING_JID_NODE);\n        } else {\n            // Fall back to legacy authentication\n            this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null);\n            this._addSysHandler(\n                this._auth1_cb.bind(this),\n                null, null, null, \"_auth_1\"\n            );\n            this.send($iq({\n                    'type': \"get\",\n                    'to': this.domain,\n                    'id': \"_auth_1\"\n                }).c(\"query\", {xmlns: Strophe.NS.AUTH})\n                .c(\"username\", {}).t(Strophe.getNodeFromJid(this.jid))\n                .tree());\n        }\n    },\n\n    /** Function: authenticate\n     * Set up authentication\n     *\n     *  Continues the initial connection request by setting up authentication\n     *  handlers and starting the authentication process.\n     *\n     *  SASL authentication will be attempted if available, otherwise\n     *  the code will fall back to legacy authentication.\n     *\n     *  Parameters:\n     *    (Array) matched - Array of SASL mechanisms supported.\n     *\n     */\n    authenticate: function (matched) {\n        if (!this._attemptSASLAuth(matched)) {\n            this._attemptLegacyAuth();\n        }\n    },\n\n    /** PrivateFunction: _sasl_challenge_cb\n     *  _Private_ handler for the SASL challenge\n     *\n     */\n    _sasl_challenge_cb: function(elem) {\n      const challenge = atob(Strophe.getText(elem));\n      const response = this._sasl_mechanism.onChallenge(this, challenge);\n      const stanza = $build('response', {'xmlns': Strophe.NS.SASL});\n      if (response !== \"\") {\n        stanza.t(btoa(response));\n      }\n      this.send(stanza.tree());\n      return true;\n    },\n\n    /** PrivateFunction: _auth1_cb\n     *  _Private_ handler for legacy authentication.\n     *\n     *  This handler is called in response to the initial <iq type='get'/>\n     *  for legacy authentication.  It builds an authentication <iq/> and\n     *  sends it, creating a handler (calling back to _auth2_cb()) to\n     *  handle the result\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The stanza that triggered the callback.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    /* jshint unused:false */\n    _auth1_cb: function (elem) {\n        // build plaintext auth iq\n        const iq = $iq({type: \"set\", id: \"_auth_2\"})\n            .c('query', {xmlns: Strophe.NS.AUTH})\n            .c('username', {}).t(Strophe.getNodeFromJid(this.jid))\n            .up()\n            .c('password').t(this.pass);\n\n        if (!Strophe.getResourceFromJid(this.jid)) {\n            // since the user has not supplied a resource, we pick\n            // a default one here.  unlike other auth methods, the server\n            // cannot do this for us.\n            this.jid = Strophe.getBareJidFromJid(this.jid) + '/strophe';\n        }\n        iq.up().c('resource', {}).t(Strophe.getResourceFromJid(this.jid));\n\n        this._addSysHandler(this._auth2_cb.bind(this), null, null, null, \"_auth_2\");\n        this.send(iq.tree());\n        return false;\n    },\n    /* jshint unused:true */\n\n    /** PrivateFunction: _sasl_success_cb\n     *  _Private_ handler for succesful SASL authentication.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The matching stanza.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    _sasl_success_cb: function (elem) {\n        if (this._sasl_data[\"server-signature\"]) {\n            let serverSignature;\n            const success = atob(Strophe.getText(elem));\n            const attribMatch = /([a-z]+)=([^,]+)(,|$)/;\n            const matches = success.match(attribMatch);\n            if (matches[1] === \"v\") {\n                serverSignature = matches[2];\n            }\n            if (serverSignature !== this._sasl_data[\"server-signature\"]) {\n                // remove old handlers\n                this.deleteHandler(this._sasl_failure_handler);\n                this._sasl_failure_handler = null;\n                if (this._sasl_challenge_handler) {\n                    this.deleteHandler(this._sasl_challenge_handler);\n                    this._sasl_challenge_handler = null;\n                }\n                this._sasl_data = {};\n                return this._sasl_failure_cb(null);\n            }\n        }\n        Strophe.info(\"SASL authentication succeeded.\");\n\n        if (this._sasl_mechanism) {\n            this._sasl_mechanism.onSuccess();\n        }\n        // remove old handlers\n        this.deleteHandler(this._sasl_failure_handler);\n        this._sasl_failure_handler = null;\n        if (this._sasl_challenge_handler) {\n            this.deleteHandler(this._sasl_challenge_handler);\n            this._sasl_challenge_handler = null;\n        }\n        const streamfeature_handlers = [];\n        const wrapper = (handlers, elem) => {\n            while (handlers.length) {\n                this.deleteHandler(handlers.pop());\n            }\n            this._sasl_auth1_cb(elem);\n            return false;\n        };\n        streamfeature_handlers.push(\n            this._addSysHandler(elem => wrapper(streamfeature_handlers, elem),\n            null, \"stream:features\", null, null)\n        );\n\n        streamfeature_handlers.push(\n            this._addSysHandler(elem => wrapper(streamfeature_handlers, elem),\n            Strophe.NS.STREAM, \"features\", null, null)\n        );\n\n        // we must send an xmpp:restart now\n        this._sendRestart();\n        return false;\n    },\n\n    /** PrivateFunction: _sasl_auth1_cb\n     *  _Private_ handler to start stream binding.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The matching stanza.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    _sasl_auth1_cb: function (elem) {\n        // save stream:features for future usage\n        this.features = elem;\n        for (let i=0; i < elem.childNodes.length; i++) {\n            const child = elem.childNodes[i];\n            if (child.nodeName === 'bind') {\n                this.do_bind = true;\n            }\n            if (child.nodeName === 'session') {\n                this.do_session = true;\n            }\n        }\n\n        if (!this.do_bind) {\n            this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);\n            return false;\n        } else {\n            this._addSysHandler(this._sasl_bind_cb.bind(this), null, null,\n                                null, \"_bind_auth_2\");\n\n            const resource = Strophe.getResourceFromJid(this.jid);\n            if (resource) {\n                this.send($iq({type: \"set\", id: \"_bind_auth_2\"})\n                          .c('bind', {xmlns: Strophe.NS.BIND})\n                          .c('resource', {}).t(resource).tree());\n            } else {\n                this.send($iq({type: \"set\", id: \"_bind_auth_2\"})\n                          .c('bind', {xmlns: Strophe.NS.BIND})\n                          .tree());\n            }\n        }\n        return false;\n    },\n\n    /** PrivateFunction: _sasl_bind_cb\n     *  _Private_ handler for binding result and session start.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The matching stanza.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    _sasl_bind_cb: function (elem) {\n        if (elem.getAttribute(\"type\") === \"error\") {\n            Strophe.info(\"SASL binding failed.\");\n            const conflict = elem.getElementsByTagName(\"conflict\");\n            let condition;\n            if (conflict.length > 0) {\n                condition = Strophe.ErrorCondition.CONFLICT;\n            }\n            this._changeConnectStatus(Strophe.Status.AUTHFAIL, condition, elem);\n            return false;\n        }\n\n        // TODO - need to grab errors\n        const bind = elem.getElementsByTagName(\"bind\");\n        if (bind.length > 0) {\n            const jidNode = bind[0].getElementsByTagName(\"jid\");\n            if (jidNode.length > 0) {\n                this.jid = Strophe.getText(jidNode[0]);\n\n                if (this.do_session) {\n                    this._addSysHandler(this._sasl_session_cb.bind(this),\n                                        null, null, null, \"_session_auth_2\");\n\n                    this.send($iq({type: \"set\", id: \"_session_auth_2\"})\n                                  .c('session', {xmlns: Strophe.NS.SESSION})\n                                  .tree());\n                } else {\n                    this.authenticated = true;\n                    this._changeConnectStatus(Strophe.Status.CONNECTED, null);\n                }\n            }\n        } else {\n            Strophe.info(\"SASL binding failed.\");\n            this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n            return false;\n        }\n    },\n\n    /** PrivateFunction: _sasl_session_cb\n     *  _Private_ handler to finish successful SASL connection.\n     *\n     *  This sets Connection.authenticated to true on success, which\n     *  starts the processing of user handlers.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The matching stanza.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    _sasl_session_cb: function (elem) {\n        if (elem.getAttribute(\"type\") === \"result\") {\n            this.authenticated = true;\n            this._changeConnectStatus(Strophe.Status.CONNECTED, null);\n        } else if (elem.getAttribute(\"type\") === \"error\") {\n            Strophe.info(\"Session creation failed.\");\n            this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n            return false;\n        }\n        return false;\n    },\n\n    /** PrivateFunction: _sasl_failure_cb\n     *  _Private_ handler for SASL authentication failure.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The matching stanza.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    /* jshint unused:false */\n    _sasl_failure_cb: function (elem) {\n        // delete unneeded handlers\n        if (this._sasl_success_handler) {\n            this.deleteHandler(this._sasl_success_handler);\n            this._sasl_success_handler = null;\n        }\n        if (this._sasl_challenge_handler) {\n            this.deleteHandler(this._sasl_challenge_handler);\n            this._sasl_challenge_handler = null;\n        }\n\n        if(this._sasl_mechanism)\n          this._sasl_mechanism.onFailure();\n        this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n        return false;\n    },\n    /* jshint unused:true */\n\n    /** PrivateFunction: _auth2_cb\n     *  _Private_ handler to finish legacy authentication.\n     *\n     *  This handler is called when the result from the jabber:iq:auth\n     *  <iq/> stanza is returned.\n     *\n     *  Parameters:\n     *    (XMLElement) elem - The stanza that triggered the callback.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    _auth2_cb: function (elem) {\n        if (elem.getAttribute(\"type\") === \"result\") {\n            this.authenticated = true;\n            this._changeConnectStatus(Strophe.Status.CONNECTED, null);\n        } else if (elem.getAttribute(\"type\") === \"error\") {\n            this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n            this.disconnect('authentication failed');\n        }\n        return false;\n    },\n\n    /** PrivateFunction: _addSysTimedHandler\n     *  _Private_ function to add a system level timed handler.\n     *\n     *  This function is used to add a Strophe.TimedHandler for the\n     *  library code.  System timed handlers are allowed to run before\n     *  authentication is complete.\n     *\n     *  Parameters:\n     *    (Integer) period - The period of the handler.\n     *    (Function) handler - The callback function.\n     */\n    _addSysTimedHandler: function (period, handler) {\n        const thand = new Strophe.TimedHandler(period, handler);\n        thand.user = false;\n        this.addTimeds.push(thand);\n        return thand;\n    },\n\n    /** PrivateFunction: _addSysHandler\n     *  _Private_ function to add a system level stanza handler.\n     *\n     *  This function is used to add a Strophe.Handler for the\n     *  library code.  System stanza handlers are allowed to run before\n     *  authentication is complete.\n     *\n     *  Parameters:\n     *    (Function) handler - The callback function.\n     *    (String) ns - The namespace to match.\n     *    (String) name - The stanza name to match.\n     *    (String) type - The stanza type attribute to match.\n     *    (String) id - The stanza id attribute to match.\n     */\n    _addSysHandler: function (handler, ns, name, type, id) {\n        const hand = new Strophe.Handler(handler, ns, name, type, id);\n        hand.user = false;\n        this.addHandlers.push(hand);\n        return hand;\n    },\n\n    /** PrivateFunction: _onDisconnectTimeout\n     *  _Private_ timeout handler for handling non-graceful disconnection.\n     *\n     *  If the graceful disconnect process does not complete within the\n     *  time allotted, this handler finishes the disconnect anyway.\n     *\n     *  Returns:\n     *    false to remove the handler.\n     */\n    _onDisconnectTimeout: function () {\n        Strophe.info(\"_onDisconnectTimeout was called\");\n        this._changeConnectStatus(Strophe.Status.CONNTIMEOUT, null);\n        this._proto._onDisconnectTimeout();\n        // actually disconnect\n        this._doDisconnect();\n        return false;\n    },\n\n    /** PrivateFunction: _onIdle\n     *  _Private_ handler to process events during idle cycle.\n     *\n     *  This handler is called every 100ms to fire timed handlers that\n     *  are ready and keep poll requests going.\n     */\n    _onIdle: function () {\n        // add timed handlers scheduled for addition\n        // NOTE: we add before remove in the case a timed handler is\n        // added and then deleted before the next _onIdle() call.\n        while (this.addTimeds.length > 0) {\n            this.timedHandlers.push(this.addTimeds.pop());\n        }\n\n        // remove timed handlers that have been scheduled for deletion\n        while (this.removeTimeds.length > 0) {\n            const thand = this.removeTimeds.pop();\n            const i = this.timedHandlers.indexOf(thand);\n            if (i >= 0) {\n                this.timedHandlers.splice(i, 1);\n            }\n        }\n\n        // call ready timed handlers\n        const now = new Date().getTime();\n        const newList = [];\n        for (let i=0; i < this.timedHandlers.length; i++) {\n            const thand = this.timedHandlers[i];\n            if (this.authenticated || !thand.user) {\n                const since = thand.lastCalled + thand.period;\n                if (since - now <= 0) {\n                    if (thand.run()) {\n                        newList.push(thand);\n                    }\n                } else {\n                    newList.push(thand);\n                }\n            }\n        }\n        this.timedHandlers = newList;\n        clearTimeout(this._idleTimeout);\n        this._proto._onIdle();\n\n        // reactivate the timer only if connected\n        if (this.connected) {\n            this._idleTimeout = setTimeout(() => this._onIdle(), 100);\n        }\n    }\n};\n\n/** Class: Strophe.SASLMechanism\n *\n *  encapsulates SASL authentication mechanisms.\n *\n *  User code may override the priority for each mechanism or disable it completely.\n *  See <priority> for information about changing priority and <test> for informatian on\n *  how to disable a mechanism.\n *\n *  By default, all mechanisms are enabled and the priorities are\n *\n *      OAUTHBEARER - 60\n *      SCRAM-SHA1 - 50\n *      DIGEST-MD5 - 40\n *      PLAIN - 30\n *      ANONYMOUS - 20\n *      EXTERNAL - 10\n *\n *  See: Strophe.Connection.addSupportedSASLMechanisms\n */\n\n/**\n * PrivateConstructor: Strophe.SASLMechanism\n * SASL auth mechanism abstraction.\n *\n *  Parameters:\n *    (String) name - SASL Mechanism name.\n *    (Boolean) isClientFirst - If client should send response first without challenge.\n *    (Number) priority - Priority.\n *\n *  Returns:\n *    A new Strophe.SASLMechanism object.\n */\nStrophe.SASLMechanism = function(name, isClientFirst, priority) {\n  /** PrivateVariable: name\n   *  Mechanism name.\n   */\n  this.name = name;\n  /** PrivateVariable: isClientFirst\n   *  If client sends response without initial server challenge.\n   */\n  this.isClientFirst = isClientFirst;\n  /** Variable: priority\n   *  Determines which <SASLMechanism> is chosen for authentication (Higher is better).\n   *  Users may override this to prioritize mechanisms differently.\n   *\n   *  In the default configuration the priorities are\n   *\n   *  SCRAM-SHA1 - 40\n   *  DIGEST-MD5 - 30\n   *  Plain - 20\n   *\n   *  Example: (This will cause Strophe to choose the mechanism that the server sent first)\n   *\n   *  > Strophe.SASLMD5.priority = Strophe.SASLSHA1.priority;\n   *\n   *  See <SASL mechanisms> for a list of available mechanisms.\n   *\n   */\n  this.priority = priority;\n};\n\nStrophe.SASLMechanism.prototype = {\n    /**\n     *  Function: test\n     *  Checks if mechanism able to run.\n     *  To disable a mechanism, make this return false;\n     *\n     *  To disable plain authentication run\n     *  > Strophe.SASLPlain.test = function() {\n     *  >   return false;\n     *  > }\n     *\n     *  See <SASL mechanisms> for a list of available mechanisms.\n     *\n     *  Parameters:\n     *    (Strophe.Connection) connection - Target Connection.\n     *\n     *  Returns:\n     *    (Boolean) If mechanism was able to run.\n     */\n    /* jshint unused:false */\n    test: function(connection) {\n        return true;\n    },\n    /* jshint unused:true */\n\n    /** PrivateFunction: onStart\n     *  Called before starting mechanism on some connection.\n     *\n     *  Parameters:\n     *    (Strophe.Connection) connection - Target Connection.\n     */\n    onStart: function(connection) {\n        this._connection = connection;\n    },\n\n    /** PrivateFunction: onChallenge\n     *  Called by protocol implementation on incoming challenge. If client is\n     *  first (isClientFirst === true) challenge will be null on the first call.\n     *\n     *  Parameters:\n     *    (Strophe.Connection) connection - Target Connection.\n     *    (String) challenge - current challenge to handle.\n     *\n     *  Returns:\n     *    (String) Mechanism response.\n     */\n    /* jshint unused:false */\n    onChallenge: function (connection, challenge) {\n        throw new Error(\"You should implement challenge handling!\");\n    },\n    /* jshint unused:true */\n\n    /** PrivateFunction: onFailure\n     *  Protocol informs mechanism implementation about SASL failure.\n     */\n    onFailure: function() {\n        this._connection = null;\n    },\n\n    /** PrivateFunction: onSuccess\n     *  Protocol informs mechanism implementation about SASL success.\n     */\n    onSuccess: function() {\n        this._connection = null;\n    }\n};\n\n/** Constants: SASL mechanisms\n *  Available authentication mechanisms\n *\n *  Strophe.SASLAnonymous - SASL ANONYMOUS authentication.\n *  Strophe.SASLPlain - SASL PLAIN authentication.\n *  Strophe.SASLMD5 - SASL DIGEST-MD5 authentication\n *  Strophe.SASLSHA1 - SASL SCRAM-SHA1 authentication\n *  Strophe.SASLOAuthBearer - SASL OAuth Bearer authentication\n *  Strophe.SASLExternal - SASL EXTERNAL authentication\n *  Strophe.SASLXOAuth2 - SASL X-OAuth2 authentication\n */\n\n// Building SASL callbacks\n\n/** PrivateConstructor: SASLAnonymous\n *  SASL ANONYMOUS authentication.\n */\nStrophe.SASLAnonymous = function() {};\nStrophe.SASLAnonymous.prototype = new Strophe.SASLMechanism(\"ANONYMOUS\", false, 20);\n\nStrophe.SASLAnonymous.prototype.test = function(connection) {\n    return connection.authcid === null;\n};\n\n\n/** PrivateConstructor: SASLPlain\n *  SASL PLAIN authentication.\n */\nStrophe.SASLPlain = function() {};\nStrophe.SASLPlain.prototype = new Strophe.SASLMechanism(\"PLAIN\", true, 50);\n\nStrophe.SASLPlain.prototype.test = function(connection) {\n    return connection.authcid !== null;\n};\n\nStrophe.SASLPlain.prototype.onChallenge = function(connection) {\n    let auth_str = connection.authzid;\n    auth_str = auth_str + \"\\u0000\";\n    auth_str = auth_str + connection.authcid;\n    auth_str = auth_str + \"\\u0000\";\n    auth_str = auth_str + connection.pass;\n    return utils.utf16to8(auth_str);\n};\n\n\n/** PrivateConstructor: SASLSHA1\n *  SASL SCRAM SHA 1 authentication.\n */\nStrophe.SASLSHA1 = function() {};\nStrophe.SASLSHA1.prototype = new Strophe.SASLMechanism(\"SCRAM-SHA-1\", true, 70);\n\nStrophe.SASLSHA1.prototype.test = function(connection) {\n    return connection.authcid !== null;\n};\n\nStrophe.SASLSHA1.prototype.onChallenge = function(connection, challenge, test_cnonce) {\n    const cnonce = test_cnonce || MD5.hexdigest(Math.random() * 1234567890);\n    let auth_str = \"n=\" + utils.utf16to8(connection.authcid);\n    auth_str += \",r=\";\n    auth_str += cnonce;\n    connection._sasl_data.cnonce = cnonce;\n    connection._sasl_data[\"client-first-message-bare\"] = auth_str;\n    auth_str = \"n,,\" + auth_str;\n\n    this.onChallenge = (connection, challenge) => {\n        let nonce, salt, iter, Hi, U, U_old, i, k;\n        let responseText = \"c=biws,\";\n        let authMessage = `${connection._sasl_data[\"client-first-message-bare\"]},${challenge},`;\n        const cnonce = connection._sasl_data.cnonce;\n        const attribMatch = /([a-z]+)=([^,]+)(,|$)/;\n\n        while (challenge.match(attribMatch)) {\n            const matches = challenge.match(attribMatch);\n            challenge = challenge.replace(matches[0], \"\");\n            switch (matches[1]) {\n            case \"r\":\n                nonce = matches[2];\n                break;\n            case \"s\":\n                salt = matches[2];\n                break;\n            case \"i\":\n                iter = matches[2];\n                break;\n            }\n        }\n\n        if (nonce.substr(0, cnonce.length) !== cnonce) {\n            connection._sasl_data = {};\n            return connection._sasl_failure_cb();\n        }\n\n        responseText += \"r=\" + nonce;\n        authMessage += responseText;\n\n        salt = atob(salt);\n        salt += \"\\x00\\x00\\x00\\x01\";\n\n        const pass = utils.utf16to8(connection.pass);\n        Hi = U_old = SHA1.core_hmac_sha1(pass, salt);\n        for (i=1; i<iter; i++) {\n            U = SHA1.core_hmac_sha1(pass, SHA1.binb2str(U_old));\n            for (k = 0; k < 5; k++) {\n                Hi[k] ^= U[k];\n            }\n            U_old = U;\n        }\n        Hi = SHA1.binb2str(Hi);\n\n        const clientKey = SHA1.core_hmac_sha1(Hi, \"Client Key\");\n        const serverKey = SHA1.str_hmac_sha1(Hi, \"Server Key\");\n        const clientSignature = SHA1.core_hmac_sha1(SHA1.str_sha1(SHA1.binb2str(clientKey)), authMessage);\n        connection._sasl_data[\"server-signature\"] = SHA1.b64_hmac_sha1(serverKey, authMessage);\n\n        for (k = 0; k < 5; k++) {\n            clientKey[k] ^= clientSignature[k];\n        }\n        responseText += \",p=\" + btoa(SHA1.binb2str(clientKey));\n        return responseText;\n    }\n    return auth_str;\n};\n\n\n/** PrivateConstructor: SASLMD5\n *  SASL DIGEST MD5 authentication.\n */\nStrophe.SASLMD5 = function() {};\nStrophe.SASLMD5.prototype = new Strophe.SASLMechanism(\"DIGEST-MD5\", false, 60);\n\nStrophe.SASLMD5.prototype.test = function(connection) {\n    return connection.authcid !== null;\n};\n\n/** PrivateFunction: _quote\n *  _Private_ utility function to backslash escape and quote strings.\n *\n *  Parameters:\n *    (String) str - The string to be quoted.\n *\n *  Returns:\n *    quoted string\n */\nStrophe.SASLMD5.prototype._quote = function (str) {\n    return '\"' + str.replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, '\\\\\"') + '\"';\n    //\" end string workaround for emacs\n};\n\nStrophe.SASLMD5.prototype.onChallenge = function(connection, challenge, test_cnonce) {\n    const attribMatch = /([a-z]+)=(\"[^\"]+\"|[^,\"]+)(?:,|$)/;\n    const cnonce = test_cnonce || MD5.hexdigest(\"\" + (Math.random() * 1234567890));\n    let realm = \"\";\n    let host = null;\n    let nonce = \"\";\n    let qop = \"\";\n\n    while (challenge.match(attribMatch)) {\n        const matches = challenge.match(attribMatch);\n        challenge = challenge.replace(matches[0], \"\");\n        matches[2] = matches[2].replace(/^\"(.+)\"$/, \"$1\");\n        switch (matches[1]) {\n        case \"realm\":\n           realm = matches[2];\n           break;\n        case \"nonce\":\n           nonce = matches[2];\n           break;\n        case \"qop\":\n           qop = matches[2];\n           break;\n        case \"host\":\n           host = matches[2];\n           break;\n        }\n    }\n    let digest_uri = connection.servtype + \"/\" + connection.domain;\n    if (host !== null) {\n        digest_uri = digest_uri + \"/\" + host;\n    }\n\n    const cred = utils.utf16to8(connection.authcid + \":\" + realm + \":\" + this._connection.pass);\n    const A1 = MD5.hash(cred) + \":\" + nonce + \":\" + cnonce;\n    const A2 = 'AUTHENTICATE:' + digest_uri;\n\n    let responseText = \"\";\n    responseText += 'charset=utf-8,';\n    responseText += 'username=' + this._quote(utils.utf16to8(connection.authcid)) + ',';\n    responseText += 'realm=' + this._quote(realm) + ',';\n    responseText += 'nonce=' + this._quote(nonce) + ',';\n    responseText += 'nc=00000001,';\n    responseText += 'cnonce=' + this._quote(cnonce) + ',';\n    responseText += 'digest-uri=' + this._quote(digest_uri) + ',';\n    responseText += 'response=' + MD5.hexdigest(MD5.hexdigest(A1) + \":\" +\n                                                nonce + \":00000001:\" +\n                                                cnonce + \":auth:\" +\n                                                MD5.hexdigest(A2)) + \",\";\n    responseText += 'qop=auth';\n    this.onChallenge = () => \"\";\n    return responseText;\n};\n\n\n/** PrivateConstructor: SASLOAuthBearer\n *  SASL OAuth Bearer authentication.\n */\nStrophe.SASLOAuthBearer = function() {};\nStrophe.SASLOAuthBearer.prototype = new Strophe.SASLMechanism(\"OAUTHBEARER\", true, 40);\n\nStrophe.SASLOAuthBearer.prototype.test = function(connection) {\n    return connection.pass !== null;\n};\n\nStrophe.SASLOAuthBearer.prototype.onChallenge = function(connection) {\n    let auth_str = 'n,';\n    if (connection.authcid !== null) {\n        auth_str = auth_str + 'a=' + connection.authzid;\n    }\n    auth_str = auth_str + ',';\n    auth_str = auth_str + \"\\u0001\";\n    auth_str = auth_str + 'auth=Bearer ';\n    auth_str = auth_str + connection.pass;\n    auth_str = auth_str + \"\\u0001\";\n    auth_str = auth_str + \"\\u0001\";\n    return utils.utf16to8(auth_str);\n};\n\n\n/** PrivateConstructor: SASLExternal\n *  SASL EXTERNAL authentication.\n *\n *  The EXTERNAL mechanism allows a client to request the server to use\n *  credentials established by means external to the mechanism to\n *  authenticate the client. The external means may be, for instance,\n *  TLS services.\n */\nStrophe.SASLExternal = function() {};\nStrophe.SASLExternal.prototype = new Strophe.SASLMechanism(\"EXTERNAL\", true, 10);\n\nStrophe.SASLExternal.prototype.onChallenge = function(connection) {\n    /** According to XEP-178, an authzid SHOULD NOT be presented when the\n     * authcid contained or implied in the client certificate is the JID (i.e.\n     * authzid) with which the user wants to log in as.\n     *\n     * To NOT send the authzid, the user should therefore set the authcid equal\n     * to the JID when instantiating a new Strophe.Connection object.\n     */\n    return connection.authcid === connection.authzid ? '' : connection.authzid;\n};\n\n\n/** PrivateConstructor: SASLXOAuth2\n *  SASL X-OAuth2 authentication.\n */\nStrophe.SASLXOAuth2 = function () { };\nStrophe.SASLXOAuth2.prototype = new Strophe.SASLMechanism(\"X-OAUTH2\", true, 30);\n\nStrophe.SASLXOAuth2.prototype.test = function (connection) {\n    return connection.pass !== null;\n};\n\nStrophe.SASLXOAuth2.prototype.onChallenge = function (connection) {\n    let auth_str = '\\u0000';\n    if (connection.authcid !== null) {\n        auth_str = auth_str + connection.authzid;\n    }\n    auth_str = auth_str + \"\\u0000\";\n    auth_str = auth_str + connection.pass;\n    return utils.utf16to8(auth_str);\n};\n\nexport const helpers = {\n    'SHA1': SHA1,\n    'MD5':  MD5\n};\n","/*\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\n/*\n * Everything that isn't used by Strophe has been stripped here!\n */\n\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\nvar safe_add = function (x, y) {\n    var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n    var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n    return (msw << 16) | (lsw & 0xFFFF);\n};\n\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\nvar bit_rol = function (num, cnt) {\n    return (num << cnt) | (num >>> (32 - cnt));\n};\n\n/*\n * Convert a string to an array of little-endian words\n */\nvar str2binl = function (str) {\n    var bin = [];\n    for(var i = 0; i < str.length * 8; i += 8)\n    {\n        bin[i>>5] |= (str.charCodeAt(i / 8) & 255) << (i%32);\n    }\n    return bin;\n};\n\n/*\n * Convert an array of little-endian words to a string\n */\nvar binl2str = function (bin) {\n    var str = \"\";\n    for(var i = 0; i < bin.length * 32; i += 8)\n    {\n        str += String.fromCharCode((bin[i>>5] >>> (i % 32)) & 255);\n    }\n    return str;\n};\n\n/*\n * Convert an array of little-endian words to a hex string.\n */\nvar binl2hex = function (binarray) {\n    var hex_tab = \"0123456789abcdef\";\n    var str = \"\";\n    for(var i = 0; i < binarray.length * 4; i++)\n    {\n        str += hex_tab.charAt((binarray[i>>2] >> ((i%4)*8+4)) & 0xF) +\n            hex_tab.charAt((binarray[i>>2] >> ((i%4)*8  )) & 0xF);\n    }\n    return str;\n};\n\n/*\n * These functions implement the four basic operations the algorithm uses.\n */\nvar md5_cmn = function (q, a, b, x, s, t) {\n    return safe_add(bit_rol(safe_add(safe_add(a, q),safe_add(x, t)), s),b);\n};\n\nvar md5_ff = function (a, b, c, d, x, s, t) {\n    return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);\n};\n\nvar md5_gg = function (a, b, c, d, x, s, t) {\n    return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);\n};\n\nvar md5_hh = function (a, b, c, d, x, s, t) {\n    return md5_cmn(b ^ c ^ d, a, b, x, s, t);\n};\n\nvar md5_ii = function (a, b, c, d, x, s, t) {\n    return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);\n};\n\n/*\n * Calculate the MD5 of an array of little-endian words, and a bit length\n */\nvar core_md5 = function (x, len) {\n    /* append padding */\n    x[len >> 5] |= 0x80 << ((len) % 32);\n    x[(((len + 64) >>> 9) << 4) + 14] = len;\n\n    var a =  1732584193;\n    var b = -271733879;\n    var c = -1732584194;\n    var d =  271733878;\n\n    var olda, oldb, oldc, oldd;\n    for (var i = 0; i < x.length; i += 16)\n    {\n        olda = a;\n        oldb = b;\n        oldc = c;\n        oldd = d;\n\n        a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);\n        d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);\n        c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);\n        b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);\n        a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);\n        d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);\n        c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);\n        b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);\n        a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);\n        d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);\n        c = md5_ff(c, d, a, b, x[i+10], 17, -42063);\n        b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);\n        a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);\n        d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);\n        c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);\n        b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);\n\n        a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);\n        d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);\n        c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);\n        b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);\n        a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);\n        d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);\n        c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);\n        b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);\n        a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);\n        d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);\n        c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);\n        b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);\n        a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);\n        d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);\n        c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);\n        b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);\n\n        a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);\n        d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);\n        c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);\n        b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);\n        a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);\n        d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);\n        c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);\n        b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);\n        a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);\n        d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);\n        c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);\n        b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);\n        a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);\n        d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);\n        c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);\n        b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);\n\n        a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);\n        d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);\n        c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);\n        b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);\n        a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);\n        d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);\n        c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);\n        b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);\n        a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);\n        d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);\n        c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);\n        b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);\n        a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);\n        d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);\n        c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);\n        b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);\n\n        a = safe_add(a, olda);\n        b = safe_add(b, oldb);\n        c = safe_add(c, oldc);\n        d = safe_add(d, oldd);\n    }\n    return [a, b, c, d];\n};\n\n/*\n * These are the functions you'll usually want to call.\n * They take string arguments and return either hex or base-64 encoded\n * strings.\n */\nconst MD5 = {\n    hexdigest: function (s) {\n        return binl2hex(core_md5(str2binl(s), s.length * 8));\n    },\n    hash: function (s) {\n        return binl2str(core_md5(str2binl(s), s.length * 8));\n    }\n};\nexport { MD5 as default };\n","/*\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\n * in FIPS PUB 180-1\n * Version 2.1a Copyright Paul Johnston 2000 - 2002.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for details.\n */\n\n/* jshint undef: true, unused: true:, noarg: true, latedef: false */\n/* global define */\n\n/* Some functions and variables have been stripped for use with Strophe */\n\n/*\n * Calculate the SHA-1 of an array of big-endian words, and a bit length\n */\nfunction core_sha1(x, len) {\n    /* append padding */\n    x[len >> 5] |= 0x80 << (24 - len % 32);\n    x[((len + 64 >> 9) << 4) + 15] = len;\n\n    var w = new Array(80);\n    var a =  1732584193;\n    var b = -271733879;\n    var c = -1732584194;\n    var d =  271733878;\n    var e = -1009589776;\n\n    var i, j, t, olda, oldb, oldc, oldd, olde;\n    for (i = 0; i < x.length; i += 16) {\n        olda = a;\n        oldb = b;\n        oldc = c;\n        oldd = d;\n        olde = e;\n\n        for (j = 0; j < 80; j++) {\n            if (j < 16) {\n                w[j] = x[i + j];\n            } else {\n                w[j] = rol(w[j-3] ^ w[j-8] ^ w[j-14] ^ w[j-16], 1);\n            }\n\n            t = safe_add(safe_add(rol(a, 5), sha1_ft(j, b, c, d)),\n                         safe_add(safe_add(e, w[j]), sha1_kt(j)));\n            e = d;\n            d = c;\n            c = rol(b, 30);\n            b = a;\n            a = t;\n        }\n\n        a = safe_add(a, olda);\n        b = safe_add(b, oldb);\n        c = safe_add(c, oldc);\n        d = safe_add(d, oldd);\n        e = safe_add(e, olde);\n    }\n    return [a, b, c, d, e];\n}\n\n/*\n * Perform the appropriate triplet combination function for the current\n * iteration\n */\nfunction sha1_ft (t, b, c, d) {\n    if (t < 20) { return (b & c) | ((~b) & d); }\n    if (t < 40) { return b ^ c ^ d; }\n    if (t < 60) { return (b & c) | (b & d) | (c & d); }\n    return b ^ c ^ d;\n}\n\n/*\n * Determine the appropriate additive constant for the current iteration\n */\nfunction sha1_kt(t) {\n    return (t < 20) ?  1518500249 : (t < 40) ?  1859775393 : (t < 60) ? -1894007588 : -899497514;\n}\n\n/*\n * Calculate the HMAC-SHA1 of a key and some data\n */\nfunction core_hmac_sha1(key, data) {\n    var bkey = str2binb(key);\n    if (bkey.length > 16) {\n        bkey = core_sha1(bkey, key.length * 8);\n    }\n\n    var ipad = new Array(16), opad = new Array(16);\n    for (var i = 0; i < 16; i++) {\n        ipad[i] = bkey[i] ^ 0x36363636;\n        opad[i] = bkey[i] ^ 0x5C5C5C5C;\n    }\n\n    var hash = core_sha1(ipad.concat(str2binb(data)), 512 + data.length * 8);\n    return core_sha1(opad.concat(hash), 512 + 160);\n}\n\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\nfunction safe_add(x, y) {\n    var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n    var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n    return (msw << 16) | (lsw & 0xFFFF);\n}\n\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\nfunction rol(num, cnt) {\n    return (num << cnt) | (num >>> (32 - cnt));\n}\n\n/*\n * Convert an 8-bit or 16-bit string to an array of big-endian words\n * In 8-bit function, characters >255 have their hi-byte silently ignored.\n */\nfunction str2binb(str) {\n    var bin = [];\n    var mask = 255;\n    for (var i = 0; i < str.length * 8; i += 8) {\n        bin[i>>5] |= (str.charCodeAt(i / 8) & mask) << (24 - i%32);\n    }\n    return bin;\n}\n\n/*\n * Convert an array of big-endian words to a base-64 string\n */\nfunction binb2b64 (binarray) {\n    var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n    var str = \"\";\n    var triplet, j;\n    for (var i = 0; i < binarray.length * 4; i += 3) {\n        triplet = (((binarray[i   >> 2] >> 8 * (3 -  i   %4)) & 0xFF) << 16) |\n                  (((binarray[i+1 >> 2] >> 8 * (3 - (i+1)%4)) & 0xFF) << 8 ) |\n                  ((binarray[i+2 >> 2] >> 8 * (3 - (i+2)%4)) & 0xFF);\n\n        for (j = 0; j < 4; j++) {\n            if (i * 8 + j * 6 > binarray.length * 32) { str += \"=\"; }\n            else { str += tab.charAt((triplet >> 6*(3-j)) & 0x3F); }\n        }\n    }\n    return str;\n}\n\n/*\n * Convert an array of big-endian words to a string\n */\nfunction binb2str(bin) {\n    var str = \"\";\n    var mask = 255;\n    for (var i = 0; i < bin.length * 32; i += 8) {\n        str += String.fromCharCode((bin[i>>5] >>> (24 - i%32)) & mask);\n    }\n    return str;\n}\n\n/*\n * These are the functions you'll usually want to call\n * They take string arguments and return either hex or base-64 encoded strings\n */\nconst SHA1 = {\n    b64_hmac_sha1:  function (key, data){ return binb2b64(core_hmac_sha1(key, data)); },\n    b64_sha1:       function (s) { return binb2b64(core_sha1(str2binb(s),s.length * 8)); },\n    binb2str:       binb2str,\n    core_hmac_sha1: core_hmac_sha1,\n    str_hmac_sha1:  function (key, data){ return binb2str(core_hmac_sha1(key, data)); },\n    str_sha1:       function (s) { return binb2str(core_sha1(str2binb(s),s.length * 8)); },\n};\nexport { SHA1 as default };\n","import * as Strophe from 'core';\nimport * as bosh from 'bosh';\nimport * as websocket from 'websocket';\nexport { Strophe };\n","const utils = {\n\n    utf16to8: function (str) {\n        var i, c;\n        var out = \"\";\n        var len = str.length;\n        for (i = 0; i < len; i++) {\n            c = str.charCodeAt(i);\n            if ((c >= 0x0000) && (c <= 0x007F)) {\n                out += str.charAt(i);\n            } else if (c > 0x07FF) {\n                out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));\n                out += String.fromCharCode(0x80 | ((c >>  6) & 0x3F));\n                out += String.fromCharCode(0x80 | ((c >>  0) & 0x3F));\n            } else {\n                out += String.fromCharCode(0xC0 | ((c >>  6) & 0x1F));\n                out += String.fromCharCode(0x80 | ((c >>  0) & 0x3F));\n            }\n        }\n        return out;\n    },\n\n    addCookies: function (cookies) {\n        /* Parameters:\n         *  (Object) cookies - either a map of cookie names\n         *    to string values or to maps of cookie values.\n         *\n         * For example:\n         * { \"myCookie\": \"1234\" }\n         *\n         * or:\n         * { \"myCookie\": {\n         *      \"value\": \"1234\",\n         *      \"domain\": \".example.org\",\n         *      \"path\": \"/\",\n         *      \"expires\": expirationDate\n         *      }\n         *  }\n         *\n         *  These values get passed to Strophe.Connection via\n         *   options.cookies\n         */\n        cookies = cookies || {};\n        for (const cookieName in cookies) {\n            if (Object.prototype.hasOwnProperty.call(cookies, cookieName)) {\n                let expires = '';\n                let domain = '';\n                let path = '';\n                const cookieObj = cookies[cookieName];\n                const isObj = typeof cookieObj === \"object\";\n                const cookieValue = escape(unescape(isObj ? cookieObj.value : cookieObj));\n                if (isObj) {\n                    expires = cookieObj.expires ? \";expires=\"+cookieObj.expires : '';\n                    domain = cookieObj.domain ? \";domain=\"+cookieObj.domain : '';\n                    path = cookieObj.path ? \";path=\"+cookieObj.path : '';\n                }\n                document.cookie =\n                    cookieName+'='+cookieValue + expires + domain + path;\n            }\n        }\n    }\n};\n\nexport { utils as default };\n","/*\n    This program is distributed under the terms of the MIT license.\n    Please see the LICENSE file for details.\n\n    Copyright 2006-2008, OGG, LLC\n*/\n\n/* global window, clearTimeout, WebSocket, DOMParser */\n\nimport { $build, Strophe } from 'core';\n\n/** Class: Strophe.WebSocket\n *  _Private_ helper class that handles WebSocket Connections\n *\n *  The Strophe.WebSocket class is used internally by Strophe.Connection\n *  to encapsulate WebSocket sessions. It is not meant to be used from user's code.\n */\n\n/** File: websocket.js\n *  A JavaScript library to enable XMPP over Websocket in Strophejs.\n *\n *  This file implements XMPP over WebSockets for Strophejs.\n *  If a Connection is established with a Websocket url (ws://...)\n *  Strophe will use WebSockets.\n *  For more information on XMPP-over-WebSocket see RFC 7395:\n *  http://tools.ietf.org/html/rfc7395\n *\n *  WebSocket support implemented by Andreas Guth (andreas.guth@rwth-aachen.de)\n */\n\n/** PrivateConstructor: Strophe.Websocket\n *  Create and initialize a Strophe.WebSocket object.\n *  Currently only sets the connection Object.\n *\n *  Parameters:\n *    (Strophe.Connection) connection - The Strophe.Connection that will use WebSockets.\n *\n *  Returns:\n *    A new Strophe.WebSocket object.\n */\nStrophe.Websocket = function(connection) {\n    this._conn = connection;\n    this.strip = \"wrapper\";\n\n    const service = connection.service;\n    if (service.indexOf(\"ws:\") !== 0 && service.indexOf(\"wss:\") !== 0) {\n        // If the service is not an absolute URL, assume it is a path and put the absolute\n        // URL together from options, current URL and the path.\n        let new_service = \"\";\n        if (connection.options.protocol === \"ws\" && window.location.protocol !== \"https:\") {\n            new_service += \"ws\";\n        } else {\n            new_service += \"wss\";\n        }\n\n        new_service += \"://\" + window.location.host;\n        if (service.indexOf(\"/\") !== 0) {\n            new_service += window.location.pathname + service;\n        } else {\n            new_service += service;\n        }\n        connection.service = new_service;\n    }\n};\n\nStrophe.Websocket.prototype = {\n    /** PrivateFunction: _buildStream\n     *  _Private_ helper function to generate the <stream> start tag for WebSockets\n     *\n     *  Returns:\n     *    A Strophe.Builder with a <stream> element.\n     */\n    _buildStream: function () {\n        return $build(\"open\", {\n            \"xmlns\": Strophe.NS.FRAMING,\n            \"to\": this._conn.domain,\n            \"version\": '1.0'\n        });\n    },\n\n    /** PrivateFunction: _check_streamerror\n     * _Private_ checks a message for stream:error\n     *\n     *  Parameters:\n     *    (Strophe.Request) bodyWrap - The received stanza.\n     *    connectstatus - The ConnectStatus that will be set on error.\n     *  Returns:\n     *     true if there was a streamerror, false otherwise.\n     */\n    _check_streamerror: function (bodyWrap, connectstatus) {\n        let errors;\n        if (bodyWrap.getElementsByTagNameNS) {\n            errors = bodyWrap.getElementsByTagNameNS(Strophe.NS.STREAM, \"error\");\n        } else {\n            errors = bodyWrap.getElementsByTagName(\"stream:error\");\n        }\n        if (errors.length === 0) {\n            return false;\n        }\n        const error = errors[0];\n\n        let condition = \"\";\n        let text = \"\";\n\n        const ns = \"urn:ietf:params:xml:ns:xmpp-streams\";\n        for (let i=0; i<error.childNodes.length; i++) {\n            const e = error.childNodes[i];\n            if (e.getAttribute(\"xmlns\") !== ns) {\n                break;\n            } if (e.nodeName === \"text\") {\n                text = e.textContent;\n            } else {\n                condition = e.nodeName;\n            }\n        }\n\n        let errorString = \"WebSocket stream error: \";\n        if (condition) {\n            errorString += condition;\n        } else {\n            errorString += \"unknown\";\n        }\n        if (text) {\n            errorString += \" - \" + text;\n        }\n        Strophe.error(errorString);\n\n        // close the connection on stream_error\n        this._conn._changeConnectStatus(connectstatus, condition);\n        this._conn._doDisconnect();\n        return true;\n    },\n\n    /** PrivateFunction: _reset\n     *  Reset the connection.\n     *\n     *  This function is called by the reset function of the Strophe Connection.\n     *  Is not needed by WebSockets.\n     */\n    _reset: function () {\n        return;\n    },\n\n    /** PrivateFunction: _connect\n     *  _Private_ function called by Strophe.Connection.connect\n     *\n     *  Creates a WebSocket for a connection and assigns Callbacks to it.\n     *  Does nothing if there already is a WebSocket.\n     */\n    _connect: function () {\n        // Ensure that there is no open WebSocket from a previous Connection.\n        this._closeSocket();\n\n        // Create the new WobSocket\n        this.socket = new WebSocket(this._conn.service, \"xmpp\");\n        this.socket.onopen = this._onOpen.bind(this);\n        this.socket.onerror = this._onError.bind(this);\n        this.socket.onclose = this._onClose.bind(this);\n        this.socket.onmessage = this._connect_cb_wrapper.bind(this);\n    },\n\n    /** PrivateFunction: _connect_cb\n     *  _Private_ function called by Strophe.Connection._connect_cb\n     *\n     * checks for stream:error\n     *\n     *  Parameters:\n     *    (Strophe.Request) bodyWrap - The received stanza.\n     */\n    _connect_cb: function(bodyWrap) {\n        const error = this._check_streamerror(bodyWrap, Strophe.Status.CONNFAIL);\n        if (error) {\n            return Strophe.Status.CONNFAIL;\n        }\n    },\n\n    /** PrivateFunction: _handleStreamStart\n     * _Private_ function that checks the opening <open /> tag for errors.\n     *\n     * Disconnects if there is an error and returns false, true otherwise.\n     *\n     *  Parameters:\n     *    (Node) message - Stanza containing the <open /> tag.\n     */\n    _handleStreamStart: function(message) {\n        let error = false;\n\n        // Check for errors in the <open /> tag\n        const ns = message.getAttribute(\"xmlns\");\n        if (typeof ns !== \"string\") {\n            error = \"Missing xmlns in <open />\";\n        } else if (ns !== Strophe.NS.FRAMING) {\n            error = \"Wrong xmlns in <open />: \" + ns;\n        }\n\n        const ver = message.getAttribute(\"version\");\n        if (typeof ver !== \"string\") {\n            error = \"Missing version in <open />\";\n        } else if (ver !== \"1.0\") {\n            error = \"Wrong version in <open />: \" + ver;\n        }\n\n        if (error) {\n            this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, error);\n            this._conn._doDisconnect();\n            return false;\n        }\n        return true;\n    },\n\n    /** PrivateFunction: _connect_cb_wrapper\n     * _Private_ function that handles the first connection messages.\n     *\n     * On receiving an opening stream tag this callback replaces itself with the real\n     * message handler. On receiving a stream error the connection is terminated.\n     */\n    _connect_cb_wrapper: function(message) {\n        if (message.data.indexOf(\"<open \") === 0 || message.data.indexOf(\"<?xml\") === 0) {\n            // Strip the XML Declaration, if there is one\n            const data = message.data.replace(/^(<\\?.*?\\?>\\s*)*/, \"\");\n            if (data === '') return;\n\n            const streamStart = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n            this._conn.xmlInput(streamStart);\n            this._conn.rawInput(message.data);\n\n            //_handleStreamSteart will check for XML errors and disconnect on error\n            if (this._handleStreamStart(streamStart)) {\n                //_connect_cb will check for stream:error and disconnect on error\n                this._connect_cb(streamStart);\n            }\n        } else if (message.data.indexOf(\"<close \") === 0) { // <close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing />\n            // Parse the raw string to an XML element\n            const parsedMessage = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n            // Report this input to the raw and xml handlers\n            this._conn.xmlInput(parsedMessage);\n            this._conn.rawInput(message.data);\n            const see_uri = parsedMessage.getAttribute(\"see-other-uri\");\n            if (see_uri) {\n                const service = this._conn.service;\n                // Valid scenarios: WSS->WSS, WS->ANY\n                const isSecureRedirect = (service.indexOf(\"wss:\") >= 0 && see_uri.indexOf(\"wss:\") >= 0) || (service.indexOf(\"ws:\") >= 0);\n                if (isSecureRedirect) {\n                    this._conn._changeConnectStatus(\n                        Strophe.Status.REDIRECT,\n                        \"Received see-other-uri, resetting connection\"\n                    );\n                    this._conn.reset();\n                    this._conn.service = see_uri;\n                    this._connect();\n                }\n            } else {\n                this._conn._changeConnectStatus(\n                    Strophe.Status.CONNFAIL,\n                    \"Received closing stream\"\n                );\n                this._conn._doDisconnect();\n            }\n        } else {\n            const string = this._streamWrap(message.data);\n            const elem = new DOMParser().parseFromString(string, \"text/xml\").documentElement;\n            this.socket.onmessage = this._onMessage.bind(this);\n            this._conn._connect_cb(elem, null, message.data);\n        }\n    },\n\n    /** PrivateFunction: _disconnect\n     *  _Private_ function called by Strophe.Connection.disconnect\n     *\n     *  Disconnects and sends a last stanza if one is given\n     *\n     *  Parameters:\n     *    (Request) pres - This stanza will be sent before disconnecting.\n     */\n    _disconnect: function (pres) {\n        if (this.socket && this.socket.readyState !== WebSocket.CLOSED) {\n            if (pres) {\n                this._conn.send(pres);\n            }\n            const close = $build(\"close\", { \"xmlns\": Strophe.NS.FRAMING });\n            this._conn.xmlOutput(close.tree());\n            const closeString = Strophe.serialize(close);\n            this._conn.rawOutput(closeString);\n            try {\n                this.socket.send(closeString);\n            } catch (e) {\n                Strophe.info(\"Couldn't send <close /> tag.\");\n            }\n        }\n        this._conn._doDisconnect();\n    },\n\n    /** PrivateFunction: _doDisconnect\n     *  _Private_ function to disconnect.\n     *\n     *  Just closes the Socket for WebSockets\n     */\n    _doDisconnect: function () {\n        Strophe.info(\"WebSockets _doDisconnect was called\");\n        this._closeSocket();\n    },\n\n    /** PrivateFunction _streamWrap\n     *  _Private_ helper function to wrap a stanza in a <stream> tag.\n     *  This is used so Strophe can process stanzas from WebSockets like BOSH\n     */\n    _streamWrap: function (stanza) {\n        return \"<wrapper>\" + stanza + '</wrapper>';\n    },\n\n\n    /** PrivateFunction: _closeSocket\n     *  _Private_ function to close the WebSocket.\n     *\n     *  Closes the socket if it is still open and deletes it\n     */\n    _closeSocket: function () {\n        if (this.socket) {\n            try {\n                this.socket.onerror = null;\n                this.socket.close();\n            } catch (e) {\n                Strophe.debug(e.message);\n            }\n        }\n        this.socket = null;\n    },\n\n    /** PrivateFunction: _emptyQueue\n     * _Private_ function to check if the message queue is empty.\n     *\n     *  Returns:\n     *    True, because WebSocket messages are send immediately after queueing.\n     */\n    _emptyQueue: function () {\n        return true;\n    },\n\n    /** PrivateFunction: _onClose\n     * _Private_ function to handle websockets closing.\n     *\n     * Nothing to do here for WebSockets\n     */\n    _onClose: function(e) {\n        if (this._conn.connected && !this._conn.disconnecting) {\n            Strophe.error(\"Websocket closed unexpectedly\");\n            this._conn._doDisconnect();\n        } else if (e && e.code === 1006 && !this._conn.connected && this.socket) {\n            // in case the onError callback was not called (Safari 10 does not\n            // call onerror when the initial connection fails) we need to\n            // dispatch a CONNFAIL status update to be consistent with the\n            // behavior on other browsers.\n            Strophe.error(\"Websocket closed unexcectedly\");\n            this._conn._changeConnectStatus(\n                Strophe.Status.CONNFAIL,\n                \"The WebSocket connection could not be established or was disconnected.\"\n            );\n            this._conn._doDisconnect();\n        } else {\n            Strophe.info(\"Websocket closed\");\n        }\n    },\n\n    /** PrivateFunction: _no_auth_received\n     *\n     * Called on stream start/restart when no stream:features\n     * has been received.\n     */\n    _no_auth_received: function (callback) {\n        Strophe.error(\"Server did not offer a supported authentication mechanism\");\n        this._changeConnectStatus(\n            Strophe.Status.CONNFAIL,\n            Strophe.ErrorCondition.NO_AUTH_MECH\n        );\n        if (callback) {\n            callback.call(this._conn);\n        }\n        this._conn._doDisconnect();\n    },\n\n    /** PrivateFunction: _onDisconnectTimeout\n     *  _Private_ timeout handler for handling non-graceful disconnection.\n     *\n     *  This does nothing for WebSockets\n     */\n    _onDisconnectTimeout: function () {},\n\n    /** PrivateFunction: _abortAllRequests\n     *  _Private_ helper function that makes sure all pending requests are aborted.\n     */\n    _abortAllRequests: function () {},\n\n    /** PrivateFunction: _onError\n     * _Private_ function to handle websockets errors.\n     *\n     * Parameters:\n     * (Object) error - The websocket error.\n     */\n    _onError: function(error) {\n        Strophe.error(\"Websocket error \" + error);\n        this._conn._changeConnectStatus(\n            Strophe.Status.CONNFAIL,\n            \"The WebSocket connection could not be established or was disconnected.\"\n        );\n        this._disconnect();\n    },\n\n    /** PrivateFunction: _onIdle\n     *  _Private_ function called by Strophe.Connection._onIdle\n     *\n     *  sends all queued stanzas\n     */\n    _onIdle: function () {\n        const data = this._conn._data;\n        if (data.length > 0 && !this._conn.paused) {\n            for (let i=0; i<data.length; i++) {\n                if (data[i] !== null) {\n                    let stanza;\n                    if (data[i] === \"restart\") {\n                        stanza = this._buildStream().tree();\n                    } else {\n                        stanza = data[i];\n                    }\n                    const rawStanza = Strophe.serialize(stanza);\n                    this._conn.xmlOutput(stanza);\n                    this._conn.rawOutput(rawStanza);\n                    this.socket.send(rawStanza);\n                }\n            }\n            this._conn._data = [];\n        }\n    },\n\n    /** PrivateFunction: _onMessage\n     * _Private_ function to handle websockets messages.\n     *\n     * This function parses each of the messages as if they are full documents.\n     * [TODO : We may actually want to use a SAX Push parser].\n     *\n     * Since all XMPP traffic starts with\n     *  <stream:stream version='1.0'\n     *                 xml:lang='en'\n     *                 xmlns='jabber:client'\n     *                 xmlns:stream='http://etherx.jabber.org/streams'\n     *                 id='3697395463'\n     *                 from='SERVER'>\n     *\n     * The first stanza will always fail to be parsed.\n     *\n     * Additionally, the seconds stanza will always be <stream:features> with\n     * the stream NS defined in the previous stanza, so we need to 'force'\n     * the inclusion of the NS in this stanza.\n     *\n     * Parameters:\n     * (string) message - The websocket message.\n     */\n    _onMessage: function(message) {\n        let elem;\n        // check for closing stream\n        const close = '<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />';\n        if (message.data === close) {\n            this._conn.rawInput(close);\n            this._conn.xmlInput(message);\n            if (!this._conn.disconnecting) {\n                this._conn._doDisconnect();\n            }\n            return;\n        } else if (message.data.search(\"<open \") === 0) {\n            // This handles stream restarts\n            elem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n            if (!this._handleStreamStart(elem)) {\n                return;\n            }\n        } else {\n            const data = this._streamWrap(message.data);\n            elem = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n        }\n\n        if (this._check_streamerror(elem, Strophe.Status.ERROR)) {\n            return;\n        }\n\n        //handle unavailable presence stanza before disconnecting\n        if (this._conn.disconnecting &&\n                elem.firstChild.nodeName === \"presence\" &&\n                elem.firstChild.getAttribute(\"type\") === \"unavailable\") {\n            this._conn.xmlInput(elem);\n            this._conn.rawInput(Strophe.serialize(elem));\n            // if we are already disconnecting we will ignore the unavailable stanza and\n            // wait for the </stream:stream> tag before we close the connection\n            return;\n        }\n        this._conn._dataRecv(elem, message.data);\n    },\n\n    /** PrivateFunction: _onOpen\n     * _Private_ function to handle websockets connection setup.\n     *\n     * The opening stream tag is sent here.\n     */\n    _onOpen: function() {\n        Strophe.info(\"Websocket open\");\n        const start = this._buildStream();\n        this._conn.xmlOutput(start.tree());\n\n        const startString = Strophe.serialize(start);\n        this._conn.rawOutput(startString);\n        this.socket.send(startString);\n    },\n\n    /** PrivateFunction: _reqToData\n     * _Private_ function to get a stanza out of a request.\n     *\n     * WebSockets don't use requests, so the passed argument is just returned.\n     *\n     *  Parameters:\n     *    (Object) stanza - The stanza.\n     *\n     *  Returns:\n     *    The stanza that was passed.\n     */\n    _reqToData: function (stanza) {\n        return stanza;\n    },\n\n    /** PrivateFunction: _send\n     *  _Private_ part of the Connection.send function for WebSocket\n     *\n     * Just flushes the messages that are in the queue\n     */\n    _send: function () {\n        this._conn.flush();\n    },\n\n    /** PrivateFunction: _sendRestart\n     *\n     *  Send an xmpp:restart stanza.\n     */\n    _sendRestart: function () {\n        clearTimeout(this._conn._idleTimeout);\n        this._conn._onIdle.bind(this._conn)();\n    }\n};\n"],"sourceRoot":""}